<?xml version="1.0" encoding="utf-8"?>
<WopiValidation>

  <Resources>
    <!-- Contains files that can be used by test cases -->
    <File Id="WordBlankDocument" Name="WordBlankDocument.docx" FilePath="Resources\WordBlankDocument.docx" />
    <File Id="WordSimpleDocument" Name="WordSimpleDocument.docx" FilePath="Resources\WordSimpleDocument.docx" />
    <File Id="WordComplexDocument" Name="WordComplexDocument.docx" FilePath="Resources\WordComplexDocument.docx" />
    <File Id="WordZeroByteDocument" Name="WordZeroBytesDocument.docx" FilePath="Resources\WordZeroBytesDocument.docx" />
    <File Id="ExcelBlankWorkbook" Name="ExcelBlankWorkbook.xlsx" FilePath="Resources\ExcelBlankWorkbook.xlsx" />
    <File Id="ZeroByteFile" Name="ZeroByteFile.wopitest" FilePath="Resources\ZeroByteFile.wopitest" />
  </Resources>

  <PrereqCases>
    <TestCase Name="AddActivitiesPrereq" Category="WopiCore">
      <Description>
        The host must support /files/AddActivities.
      </Description>
      <Requests>
        <CheckFileInfo>
          <Validators>
            <JsonResponseContentValidator>
              <BooleanProperty Name="SupportsAddActivities" ExpectedValue="true" IsRequired="true" />
            </JsonResponseContentValidator>
          </Validators>
        </CheckFileInfo>
      </Requests>
    </TestCase>

    <TestCase Name="WopiValidatorPrereq" Category="WopiCore">
      <Description>
        The prereq WOPI validation that must pass prior to running the (potentially destructive) test suite.
      </Description>
      <Requests>
        <CheckFileInfo>
          <Validators>
            <JsonResponseContentValidator>
              <StringProperty Name="BaseFileName" EndsWith=".wopitest" IsRequired="true" IgnoreCase="true" />
            </JsonResponseContentValidator>
          </Validators>
        </CheckFileInfo>
      </Requests>
    </TestCase>

    <TestCase Name="UserCanWritePrereq" Document="WordBlankDocument" Category="WopiCore">
      <Description>
        Prereq WOPI Validation test to check if the user has permission to perform Write operation.
      </Description>
      <Requests>
        <CheckFileInfo>
          <Validators>
            <JsonResponseContentValidator>
              <BooleanProperty Name="UserCanWrite" ExpectedValue="true" IsRequired="true" />
            </JsonResponseContentValidator>
          </Validators>
        </CheckFileInfo>
      </Requests>
    </TestCase>

    <TestCase Name="UserCanNotWriteRelativePrereq" Document="WordBlankDocument" Category="WopiCore">
      <Description>
        Prereq WOPI Validation test to check if the user is denied permission to call PutRelativeFile.
      </Description>
      <Requests>
        <CheckFileInfo>
          <Validators>
            <JsonResponseContentValidator>
              <BooleanProperty Name="UserCanNotWriteRelative" ExpectedValue="true" IsRequired="true" />
            </JsonResponseContentValidator>
          </Validators>
        </CheckFileInfo>
      </Requests>
    </TestCase>

    <TestCase Name="NotReadOnlyPrereq" Document="WordBlankDocument" Category="WopiCore">
      <Description>
        Prereq WOPI Validation test to check if file can be changed by the user.
      </Description>
      <Requests>
        <CheckFileInfo>
          <Validators>
            <JsonResponseContentValidator>
              <BooleanProperty Name="ReadOnly" ExpectedValue="false" />
            </JsonResponseContentValidator>
          </Validators>
        </CheckFileInfo>
      </Requests>
    </TestCase>

    <TestCase Name="UserCanWriteRelativePrereq" Document="WordBlankDocument" Category="WopiCore">
      <Description>
        Prereq WOPI Validation test to check if the user has permission to call PutRelativeFile.
      </Description>
      <Requests>
        <CheckFileInfo>
          <Validators>
            <JsonResponseContentValidator>
              <BooleanProperty Name="UserCanNotWriteRelative" ExpectedValue="false" />
            </JsonResponseContentValidator>
          </Validators>
        </CheckFileInfo>
      </Requests>
    </TestCase>

    <TestCase Name="LocksPrereq" Document="WordBlankDocument" Category="WopiCore">
      <Description>
        Prereq WOPI Validation test to check if the host declares support for Lock/Unlock/RefreshLock/UnlockAndRefreshLock
        operations.
      </Description>
      <Requests>
        <CheckFileInfo>
          <Validators>
            <JsonResponseContentValidator>
              <BooleanProperty Name="SupportsLocks" ExpectedValue="true" IsRequired="true"/>
            </JsonResponseContentValidator>
          </Validators>
        </CheckFileInfo>
      </Requests>
    </TestCase>

    <TestCase Name="FileEditingPrereq" Document="WordBlankDocument" Category="WopiCore">
      <Description>
        Prereq WOPI Validation test to check if host declares support for PutFile/PutRelativeFile operations.
      </Description>
      <Requests>
        <CheckFileInfo>
          <Validators>
            <JsonResponseContentValidator>
              <BooleanProperty Name="SupportsUpdate" ExpectedValue="true" IsRequired="true"/>
            </JsonResponseContentValidator>
          </Validators>
        </CheckFileInfo>
      </Requests>
    </TestCase>

    <TestCase Name="BusinessFlowPrereq" Document="WordBlankDocument" Category="WopiCore">
      <Description>
        The prereq BusinessFlowPrereq must pass prior to running the feature validations related to business flows.
      </Description>
      <Requests>
        <CheckFileInfo>
          <Validators>
            <JsonResponseContentValidator>
              <BooleanProperty Name="LicenseCheckForEditIsEnabled" IsRequired="true" ExpectedValue="true" />
            </JsonResponseContentValidator>
          </Validators>
        </CheckFileInfo>
      </Requests>
    </TestCase>

    <TestCase Name="FileUrlUsagePrereq" Document="WordBlankDocument" Category="WopiCore">
      <Description>
        The host uses FileUrl for direct file access.
      </Description>
      <Requests>
        <CheckFileInfo>
          <Validators>
            <JsonResponseContentValidator>
              <AbsoluteUrlProperty Name="FileUrl" IsRequired="true" />
            </JsonResponseContentValidator>
          </Validators>
        </CheckFileInfo>
      </Requests>
    </TestCase>

    <TestCase Name="SupportedShareUrlTypesForFilePrereq" Document="WordBlankDocument" Category="WopiCore">
      <Description>
        Prereq WOPI Validation test to check if the host sets SupportedShareUrlTypes in CheckFileInfo to any value.
      </Description>
      <Requests>
        <CheckFileInfo>
          <Validators>
            <JsonResponseContentValidator>
              <ArrayProperty Name="SupportedShareUrlTypes" IsRequired="true" />
            </JsonResponseContentValidator>
          </Validators>
        </CheckFileInfo>
      </Requests>
    </TestCase>

    <TestCase Name="RenameFilePrereq" Document="WordBlankDocument" Category="WopiCore">
      <Description>
        Prereq WOPI Validation test to check if host declares support for RenameFile operation.
      </Description>
      <Requests>
        <CheckFileInfo>
          <Validators>
            <JsonResponseContentValidator>
              <BooleanProperty Name="SupportsRename" ExpectedValue="true" IsRequired="true" />
            </JsonResponseContentValidator>
          </Validators>
        </CheckFileInfo>
      </Requests>
    </TestCase>

    <TestCase Name="SupportsScenarioLinksPrereq" Document="WordBlankDocument" Category="WopiCore">
      <Description>
        Prereq WOPI Validation test to check if the host declares support for GetRestrictedLink/RevokeRestrictedLink
      </Description>
      <Requests>
        <CheckFileInfo>
          <Validators>
            <JsonResponseContentValidator>
              <BooleanProperty Name="SupportsScenarioLinks" ExpectedValue="true" IsRequired="true" />
            </JsonResponseContentValidator>
          </Validators>
        </CheckFileInfo>
      </Requests>
    </TestCase>

    <TestCase Name="SupportsSecureStorePrereq" Document="WordBlankDocument" Category="WopiCore">
      <Description>
        Prereq WOPI Validation test to check if the host declares support for ReadSecureStore
      </Description>
      <Requests>
        <CheckFileInfo>
          <Validators>
            <JsonResponseContentValidator>
              <BooleanProperty Name="SupportsSecureStore" ExpectedValue="true" IsRequired="true" />
            </JsonResponseContentValidator>
          </Validators>
        </CheckFileInfo>
      </Requests>
    </TestCase>

    <TestCase Name="SupportsFoldersPrereq" Document="WordBlankDocument" Category="WopiCore">
      <Description>
        Prereq WOPI Validation test to check if the host declares support for EnumerateChildren and DeleteFile
      </Description>
      <Requests>
        <CheckFileInfo>
          <Validators>
            <JsonResponseContentValidator>
              <BooleanProperty Name="SupportsFolders" ExpectedValue="true" IsRequired="true" />
            </JsonResponseContentValidator>
          </Validators>
        </CheckFileInfo>
      </Requests>
    </TestCase>

    <TestCase Name="ShareUrlTypeReadOnlyForFilePrereq" Document="WordBlankDocument" Category="WopiCore">
      <Description>
        Prereq WOPI Validation test to check if the host declares support for the "ReadOnly" Share Url type for the file.
      </Description>
      <Requests>
        <CheckFileInfo>
          <Validators>
            <JsonResponseContentValidator>
              <ArrayProperty Name="SupportedShareUrlTypes" ContainsValue="ReadOnly" IsRequired="true" />
            </JsonResponseContentValidator>
          </Validators>
        </CheckFileInfo>
      </Requests>
    </TestCase>

    <TestCase Name="ShareUrlTypeReadWriteForFilePrereq" Document="WordBlankDocument" Category="WopiCore">
      <Description>
        Prereq WOPI Validation test to check if the host declares support for the "ReadWrite" Share Url type for the file.
      </Description>
      <Requests>
        <CheckFileInfo>
          <Validators>
            <JsonResponseContentValidator>
              <ArrayProperty Name="SupportedShareUrlTypes" ContainsValue="ReadWrite" IsRequired="true" />
            </JsonResponseContentValidator>
          </Validators>
        </CheckFileInfo>
      </Requests>
    </TestCase>
  </PrereqCases>

  <TestGroup Name="AddActivities">
    <PrereqTests>
      <PrereqTest>WopiValidatorPrereq</PrereqTest>
      <PrereqTest>FileEditingPrereq</PrereqTest>
      <PrereqTest>AddActivitiesPrereq</PrereqTest>
    </PrereqTests>
    <TestCases>
      <!-- /files/AddActivities -->
      <TestCase Name="files.AddActivitiesSingleMinimalComment" Category="WopiCore">
        <Description>one comment, minimal properties</Description>
        <Requests>
          <AddActivities>
            <RequestBody>
              <![CDATA[{ "Activities": [
              {
                "Type": "comment",
                "Id": "00000014-0000-0000-0000-000000000000",
                "Timestamp": "2017-03-15T13:47:13000000Z",
                "Data": {
                  "ContentId": "cid123",
                  "ContentAction": "created"
                }
              }
              ] }]]>
            </RequestBody>
            <Validators>
              <JsonResponseContentValidator>
                <StringProperty Name="ActivityResponses[0].Id" IsRequired="true" ExpectedValue="00000014-0000-0000-0000-000000000000" />
              </JsonResponseContentValidator>
              <Or>
                <JsonResponseContentValidator>
                  <IntegerProperty Name="ActivityResponses[0].Status" ExpectedValue="0"/>
                </JsonResponseContentValidator>
                <JsonResponseContentValidator>
                  <IntegerProperty Name="ActivityResponses[0].Status" ExpectedValue="3" />
                </JsonResponseContentValidator>
              </Or>
            </Validators>
          </AddActivities>
        </Requests>
      </TestCase>

      <TestCase Name="files.AddActivitiesSingleFullComment" Category="WopiCore">
        <Description>one comment with all data properties set</Description>
        <Requests>
          <AddActivities>
            <RequestBody>
              <![CDATA[{ "Activities": [
              {
                "Type": "comment",
                "Id": "00000001-0000-0000-0000-000000000000",
                "Created": "2017-02-15T13:47:13000000Z",
                "Data": {
                  "CommentText": "basic text",
                  "ContentId": "cid123",
                  "NavigationId": "nid123",
                  "ContentAction": "created",
                  "IsReply": true
                }
              }
              ] }]]>
            </RequestBody>
            <Validators>
              <JsonSchemaValidator Schema="AddActivitiesRequestSchema" />
              <JsonSchemaValidator Schema="AddActivitiesResponseSchema" />
              <JsonResponseContentValidator>
                <StringProperty Name="ActivityResponses[0].Id" IsRequired="true" ExpectedValue="00000001-0000-0000-0000-000000000000" />
              </JsonResponseContentValidator>
              <Or>
                <JsonResponseContentValidator>
                  <IntegerProperty Name="ActivityResponses[0].Status" ExpectedValue="0"/>
                </JsonResponseContentValidator>
                <JsonResponseContentValidator>
                  <IntegerProperty Name="ActivityResponses[0].Status" ExpectedValue="3" />
                </JsonResponseContentValidator>
              </Or>
            </Validators>
          </AddActivities>
        </Requests>
      </TestCase>

      <TestCase Name="files.AddActivitiesAllCapsID" Category="WopiCore">
        <Description>one comment with all-caps ID GUID</Description>
        <Requests>
          <AddActivities>
            <RequestBody>
              <![CDATA[{ "Activities": [
              {
                "Type": "comment",
                "Id": "00000002-ABCD-ABCD-ABCD-ABCDEFABCDEF",
                "Created": "2017-02-15T13:47:13000000Z",
                "Data": {
                  "ContentId": "cid123",
                  "ContentAction": "created"
                }
              }
              ] }]]>
            </RequestBody>
            <Validators>
              <JsonResponseContentValidator>
                <StringProperty Name="ActivityResponses[0].Id" IsRequired="true" ExpectedValue="00000002-ABCD-ABCD-ABCD-ABCDEFABCDEF" />
              </JsonResponseContentValidator>
              <Or>
                <JsonResponseContentValidator>
                  <IntegerProperty Name="ActivityResponses[0].Status" ExpectedValue="0"/>
                </JsonResponseContentValidator>
                <JsonResponseContentValidator>
                  <IntegerProperty Name="ActivityResponses[0].Status" ExpectedValue="3" />
                </JsonResponseContentValidator>
              </Or>
            </Validators>
          </AddActivities>
        </Requests>
      </TestCase>

      <TestCase Name="files.AddActivitiesMaxLengthContentID" Category="WopiCore">
        <Description>one comment with max-length ContentID</Description>
        <Requests>
          <AddActivities>
            <RequestBody>
              <![CDATA[{ "Activities": [
              {
                "Type": "comment",
                "Id": "00000004-0000-0000-0000-000000000000",
                "Created": "2017-02-15T13:47:13000000Z",
                "Data": {
                  "ContentId": "0123456789abcdef0123456789abcdef0123456789abcdef0123456789abcdef0123456789abcdef0123456789abcdef0123456789abcdef0123456789abcdef0123456789abcdef0123456789abcdef0123456789abcdef0123456789abcdef0123456789abcdef0123456789abcdef0123456789abcdef0123456789abcdef0123456789abcdef0123456789abcdef0123456789abcdef0123456789abcdef0123456789abcdef0123456789abcdef0123456789abcdef0123456789abcdef0123456789abcdef0123456789abcdef0123456789abcdef0123456789abcdef0123456789abcdef0123456789abcdef0123456789abcdef0123456789abcdef0123456789abcdef0123456789abcdef0123456789abcdef0123456789abcdef0123456789abcdef0123456789abcdef0123456789abcdef0123456789abcdef0123456789abcdef0123456789abcdef0123456789abcdef0123456789abcdef0123456789abcdef0123456789abcdef0123456789abcdef0123456789abcdef0123456789abcdef0123456789abcdef0123456789abcdef0123456789abcdef0123456789abcdef0123456789abcdef0123456789abcdef0123456789abcdef0123456789abcdef0123456789abcdef0123456789abcdef0123456789abcdef0123456789abcdef0123456789abcdef0123456789abcdef0123456789abcdef",
                  "ContentAction": "created"
                }
              }
              ] }]]>
            </RequestBody>
            <Validators>
              <JsonResponseContentValidator>
                <StringProperty Name="ActivityResponses[0].Id" IsRequired="true" ExpectedValue="00000004-0000-0000-0000-000000000000" />
              </JsonResponseContentValidator>
              <Or>
                <JsonResponseContentValidator>
                  <IntegerProperty Name="ActivityResponses[0].Status" ExpectedValue="0"/>
                </JsonResponseContentValidator>
                <JsonResponseContentValidator>
                  <IntegerProperty Name="ActivityResponses[0].Status" ExpectedValue="3" />
                </JsonResponseContentValidator>
              </Or>
            </Validators>
          </AddActivities>
        </Requests>
      </TestCase>

      <TestCase Name="files.AddActivitiesMaxLengthNavigationId" Category="WopiCore">
        <Description>one comment with max-length NavigationId</Description>
        <Requests>
          <AddActivities>
            <RequestBody>
              <![CDATA[{ "Activities": [
              {
                "Type": "comment",
                "Id": "00000005-0000-0000-0000-000000000000",
                "Created": "2017-02-15T13:47:13000000Z",
                "Data": {
                  "ContentId": "cid123",
                  "NavigationId": "0123456789abcdef0123456789abcdef0123456789abcdef0123456789abcdef0123456789abcdef0123456789abcdef0123456789abcdef0123456789abcdef0123456789abcdef0123456789abcdef0123456789abcdef0123456789abcdef0123456789abcdef0123456789abcdef0123456789abcdef0123456789abcdef0123456789abcdef0123456789abcdef0123456789abcdef0123456789abcdef0123456789abcdef0123456789abcdef0123456789abcdef0123456789abcdef0123456789abcdef0123456789abcdef0123456789abcdef0123456789abcdef0123456789abcdef0123456789abcdef0123456789abcdef0123456789abcdef0123456789abcdef0123456789abcdef0123456789abcdef0123456789abcdef0123456789abcdef0123456789abcdef0123456789abcdef0123456789abcdef0123456789abcdef0123456789abcdef0123456789abcdef0123456789abcdef0123456789abcdef0123456789abcdef0123456789abcdef0123456789abcdef0123456789abcdef0123456789abcdef0123456789abcdef0123456789abcdef0123456789abcdef0123456789abcdef0123456789abcdef0123456789abcdef0123456789abcdef0123456789abcdef0123456789abcdef0123456789abcdef0123456789abcdef0123456789abcdef0123456789abcdef0123456789abcdef",
                  "ContentAction": "created"
                }
              }
              ] }]]>
            </RequestBody>
            <Validators>
              <JsonResponseContentValidator>
                <StringProperty Name="ActivityResponses[0].Id" IsRequired="true" ExpectedValue="00000005-0000-0000-0000-000000000000" />
              </JsonResponseContentValidator>
              <Or>
                <JsonResponseContentValidator>
                  <IntegerProperty Name="ActivityResponses[0].Status" ExpectedValue="0"/>
                </JsonResponseContentValidator>
                <JsonResponseContentValidator>
                  <IntegerProperty Name="ActivityResponses[0].Status" ExpectedValue="3" />
                </JsonResponseContentValidator>
              </Or>
            </Validators>
          </AddActivities>
        </Requests>
      </TestCase>

      <TestCase Name="files.AddActivitiesCommentUpdate" Category="WopiCore">
        <Description>one comment with ContentAction=update</Description>
        <Requests>
          <AddActivities>
            <RequestBody>
              <![CDATA[{ "Activities": [
              {
                "Type": "comment",
                "Id": "00000006-0000-0000-0000-000000000000",
                "Created": "2017-02-15T13:47:13000000Z",
                "Data": {
                  "ContentId": "cid123",
                  "ContentAction": "updated"
                }
              }
              ] }]]>
            </RequestBody>
            <Validators>
              <JsonResponseContentValidator>
                <StringProperty Name="ActivityResponses[0].Id" IsRequired="true" ExpectedValue="00000006-0000-0000-0000-000000000000" />
              </JsonResponseContentValidator>
              <Or>
                <JsonResponseContentValidator>
                  <IntegerProperty Name="ActivityResponses[0].Status" ExpectedValue="0"/>
                </JsonResponseContentValidator>
                <JsonResponseContentValidator>
                  <IntegerProperty Name="ActivityResponses[0].Status" ExpectedValue="3" />
                </JsonResponseContentValidator>
              </Or>
            </Validators>
          </AddActivities>
        </Requests>
      </TestCase>

      <TestCase Name="files.AddActivitiesCommentDelete" Category="WopiCore">
        <Description>one comment with ContentAction=delete</Description>
        <Requests>
          <AddActivities>
            <RequestBody>
              <![CDATA[{ "Activities": [
              {
                "Type": "comment",
                "Id": "00000007-0000-0000-0000-000000000000",
                "Created": "2017-02-15T13:47:13000000Z",
                "Data": {
                  "ContentId": "cid123",
                  "ContentAction": "deleted"
                }
              }
              ] }]]>
            </RequestBody>
            <Validators>
              <JsonResponseContentValidator>
                <StringProperty Name="ActivityResponses[0].Id" IsRequired="true" ExpectedValue="00000007-0000-0000-0000-000000000000" />
              </JsonResponseContentValidator>
              <Or>
                <JsonResponseContentValidator>
                  <IntegerProperty Name="ActivityResponses[0].Status" ExpectedValue="0"/>
                </JsonResponseContentValidator>
                <JsonResponseContentValidator>
                  <IntegerProperty Name="ActivityResponses[0].Status" ExpectedValue="3" />
                </JsonResponseContentValidator>
              </Or>
            </Validators>
          </AddActivities>
        </Requests>
      </TestCase>

      <TestCase Name="files.AddActivitiesWithBonusToplevelProperty" Category="WopiCore">
        <Description>one comment with bogus additional toplevel property</Description>
        <Requests>
          <AddActivities>
            <RequestBody>
              <![CDATA[{ "Activities": [
              {
                "Type": "comment",
                "Id": "00000008-0000-0000-0000-000000000000",
                "Created": "2017-02-15T13:47:13000000Z",
                "Data": {
                  "ContentId": "cid123",
                  "ContentAction": "created"
                },
                "BonusTopLevelProperty": "future compatibility!"
              }
              ] }]]>
            </RequestBody>
            <Validators>
              <JsonResponseContentValidator>
                <StringProperty Name="ActivityResponses[0].Id" IsRequired="true" ExpectedValue="00000008-0000-0000-0000-000000000000" />
              </JsonResponseContentValidator>
              <Or>
                <JsonResponseContentValidator>
                  <IntegerProperty Name="ActivityResponses[0].Status" ExpectedValue="0"/>
                </JsonResponseContentValidator>
                <JsonResponseContentValidator>
                  <IntegerProperty Name="ActivityResponses[0].Status" ExpectedValue="3" />
                </JsonResponseContentValidator>
              </Or>
            </Validators>
          </AddActivities>
        </Requests>
      </TestCase>

      <TestCase Name="files.AddActivitiesWithBonusDataProperty" Category="WopiCore">
        <Description>one comment with bogus additional data property</Description>
        <Requests>
          <AddActivities>
            <RequestBody>
              <![CDATA[{ "Activities": [
              {
                "Type": "comment",
                "Id": "00000003-0000-0000-0000-000000000000",
                "Created": "2017-02-15T13:47:13000000Z",
                "Data": {
                  "ContentId": "cid123",
                  "ContentAction": "created",
                  "BonusProperty": "future compatibility!"
                }
              }
              ] }]]>
            </RequestBody>
            <Validators>
              <JsonResponseContentValidator>
                <StringProperty Name="ActivityResponses[0].Id" IsRequired="true" ExpectedValue="00000003-0000-0000-0000-000000000000" />
              </JsonResponseContentValidator>
              <Or>
                <JsonResponseContentValidator>
                  <IntegerProperty Name="ActivityResponses[0].Status" ExpectedValue="0"/>
                </JsonResponseContentValidator>
                <JsonResponseContentValidator>
                  <IntegerProperty Name="ActivityResponses[0].Status" ExpectedValue="3" />
                </JsonResponseContentValidator>
              </Or>
            </Validators>
          </AddActivities>
        </Requests>
      </TestCase>

      <TestCase Name="files.AddActivitiesCommentAndPerson" Category="WopiCore">
        <Description>one comment, one person</Description>
        <Requests>
          <AddActivities>
            <RequestBody>
              <![CDATA[{ "Activities": [
              {
                "Type": "comment",
                "Id": "00000009-0000-0000-0000-000000000000",
                "Created": "2017-02-15T13:47:13000000Z",
                "Data": {
                  "ContentId": "cid123",
                  "ContentAction": "created"
                },
                "People": [
                  {
                    "Name": "John Able",
                    "Id": "111",
                    "Provider": "wopi-contoso",
                    "Mentioned": true
                  }
                ]
              }
              ] }]]>
            </RequestBody>
            <Validators>
              <JsonSchemaValidator Schema="AddActivitiesRequestSchema" />
              <JsonSchemaValidator Schema="AddActivitiesResponseSchema" />
              <JsonResponseContentValidator>
                <StringProperty Name="ActivityResponses[0].Id" IsRequired="true" ExpectedValue="00000009-0000-0000-0000-000000000000" />
              </JsonResponseContentValidator>
              <Or>
                <JsonResponseContentValidator>
                  <IntegerProperty Name="ActivityResponses[0].Status" ExpectedValue="0"/>
                </JsonResponseContentValidator>
                <JsonResponseContentValidator>
                  <IntegerProperty Name="ActivityResponses[0].Status" ExpectedValue="3" />
                </JsonResponseContentValidator>
              </Or>
            </Validators>
          </AddActivities>
        </Requests>
      </TestCase>

      <TestCase Name="files.AddActivitiesCommentWithThreePeople" Category="WopiCore">
        <Description>one comment, three people</Description>
        <Requests>
          <AddActivities>
            <RequestBody>
              <![CDATA[{ "Activities": [
              {
                "Type": "comment",
                "Id": "0000000a-0000-0000-0000-000000000000",
                "Created": "2017-02-15T13:47:13000000Z",
                "Data": {
                  "ContentId": "cid123",
                  "ContentAction": "created"
                },
                "People": [
                  {
                    "Name": "John Able",
                    "Id": "111",
                    "Provider": "wopi-contoso",
                    "Mentioned": true
                  },
                  {
                    "Name": "Jane Baker",
                    "Id": "222",
                    "Provider": "wopi-contoso",
                    "InThread": true
                  },
                  {
                    "Name": "Pat Charlie",
                    "Id": "333",
                    "Provider": "wopi-contoso",
                    "InThread": true,
                    "RepliedTo": true
                  }
                ]
              }
              ] }]]>
            </RequestBody>
            <Validators>
              <JsonSchemaValidator Schema="AddActivitiesRequestSchema" />
              <JsonSchemaValidator Schema="AddActivitiesResponseSchema" />
              <JsonResponseContentValidator>
                <StringProperty Name="ActivityResponses[0].Id" IsRequired="true" ExpectedValue="0000000a-0000-0000-0000-000000000000" />
              </JsonResponseContentValidator>
              <Or>
                <JsonResponseContentValidator>
                  <IntegerProperty Name="ActivityResponses[0].Status" ExpectedValue="0"/>
                </JsonResponseContentValidator>
                <JsonResponseContentValidator>
                  <IntegerProperty Name="ActivityResponses[0].Status" ExpectedValue="3" />
                </JsonResponseContentValidator>
              </Or>
            </Validators>
          </AddActivities>
        </Requests>
      </TestCase>

      <TestCase Name="files.AddActivitiesCommentWithPersonBonusProperty" Category="WopiCore">
        <Description>one comment, one person with bogus additional property</Description>
        <Requests>
          <AddActivities>
            <RequestBody>
              <![CDATA[{ "Activities": [
              {
                "Type": "comment",
                "Id": "0000000b-0000-0000-0000-000000000000",
                "Created": "2017-02-15T13:47:13000000Z",
                "Data": {
                  "ContentId": "cid123",
                  "ContentAction": "created"
                },
                "People": [
                  {
                    "Name": "John Able",
                    "Id": "111",
                    "Provider": "wopi-contoso",
                    "Mentioned": true,
                    "BonusProperty": "future compatibility!"
                  }
                ]
              }
              ] }]]>
            </RequestBody>
            <Validators>
              <JsonResponseContentValidator>
                <StringProperty Name="ActivityResponses[0].Id" IsRequired="true" ExpectedValue="0000000b-0000-0000-0000-000000000000" />
              </JsonResponseContentValidator>
              <Or>
                <JsonResponseContentValidator>
                  <IntegerProperty Name="ActivityResponses[0].Status" ExpectedValue="0"/>
                </JsonResponseContentValidator>
                <JsonResponseContentValidator>
                  <IntegerProperty Name="ActivityResponses[0].Status" ExpectedValue="3" />
                </JsonResponseContentValidator>
              </Or>
            </Validators>
          </AddActivities>
        </Requests>
      </TestCase>

      <TestCase Name="files.AddActivitiesCommentWithNonWopiPerson" Category="WopiCore">
        <Description>one comment, one person with non-wopi provider and ID</Description>
        <Requests>
          <AddActivities>
            <RequestBody>
              <![CDATA[{ "Activities": [
              {
                "Type": "comment",
                "Id": "0000000c-0000-0000-0000-000000000000",
                "Created": "2017-02-15T13:47:13000000Z",
                "Data": {
                  "ContentId": "cid123",
                  "ContentAction": "created"
                },
                "People": [
                  {
                    "Name": "Don Delta",
                    "Id": "{00000000-0000-0000-0000-000000000000}",
                    "Provider": "Windows Live",
                    "Mentioned": true
                  }
                ]
              }
              ] }]]>
            </RequestBody>
            <Validators>
              <JsonResponseContentValidator>
                <StringProperty Name="ActivityResponses[0].Id" IsRequired="true" ExpectedValue="0000000c-0000-0000-0000-000000000000" />
              </JsonResponseContentValidator>
              <Or>
                <JsonResponseContentValidator>
                  <IntegerProperty Name="ActivityResponses[0].Status" ExpectedValue="0"/>
                </JsonResponseContentValidator>
                <JsonResponseContentValidator>
                  <IntegerProperty Name="ActivityResponses[0].Status" ExpectedValue="3" />
                </JsonResponseContentValidator>
              </Or>
            </Validators>
          </AddActivities>
        </Requests>
      </TestCase>

      <TestCase Name="files.AddActivitiesUnknownActivityType" Category="WopiCore">
        <Description>one activity with bogus type</Description>
        <Requests>
          <AddActivities>
            <RequestBody>
              <![CDATA[{ "Activities": [
              {
                "Type": "unsupported",
                "Id": "0000000d-0000-0000-0000-000000000000",
                "Created": "2017-02-15T13:47:13000000Z",
                "Data": {
                  "ContentId": "cid123",
                  "ContentAction": "created"
                }
              }
              ] }]]>
            </RequestBody>
            <Validators>
              <JsonResponseContentValidator>
                <StringProperty Name="ActivityResponses[0].Id" IsRequired="true" ExpectedValue="0000000d-0000-0000-0000-000000000000" />
              </JsonResponseContentValidator>
              <Or>
                <JsonResponseContentValidator>
                  <IntegerProperty Name="ActivityResponses[0].Status" ExpectedValue="0"/>
                </JsonResponseContentValidator>
                <JsonResponseContentValidator>
                  <IntegerProperty Name="ActivityResponses[0].Status" ExpectedValue="3" />
                </JsonResponseContentValidator>
              </Or>
            </Validators>
          </AddActivities>
        </Requests>
      </TestCase>

      <TestCase Name="files.AddActivitiesUnknownNoDataActivity" Category="WopiCore">
        <Description>one activity with bogus type and no data</Description>
        <Requests>
          <AddActivities>
            <RequestBody>
              <![CDATA[{ "Activities": [
              {
                "Type": "unsupported",
                "Id": "0000000e-0000-0000-0000-000000000000",
                "Created": "2017-02-15T13:47:13000000Z"
              }
              ] }]]>
            </RequestBody>
            <Validators>
              <JsonResponseContentValidator>
                <StringProperty Name="ActivityResponses[0].Id" IsRequired="true" ExpectedValue="0000000e-0000-0000-0000-000000000000" />
              </JsonResponseContentValidator>
              <Or>
                <JsonResponseContentValidator>
                  <IntegerProperty Name="ActivityResponses[0].Status" ExpectedValue="0"/>
                </JsonResponseContentValidator>
                <JsonResponseContentValidator>
                  <IntegerProperty Name="ActivityResponses[0].Status" ExpectedValue="3" />
                </JsonResponseContentValidator>
              </Or>
            </Validators>
          </AddActivities>
        </Requests>
      </TestCase>

      <TestCase Name="files.AddActivitiesTwoActivitiesOneUnknown" Category="WopiCore">
        <Description>one comment and one activity with bogus type</Description>
        <Requests>
          <AddActivities>
            <RequestBody>
              <![CDATA[{ "Activities": [
              {
                "Type": "comment",
                "Id": "0000000f-0000-0000-0000-000000000000",
                "Created": "2017-02-15T13:47:13000000Z",
                "Data": {
                  "ContentId": "cid123",
                  "ContentAction": "created"
                }
              },
              {
                "Type": "unsupported",
                "Id": "00000010-0000-0000-0000-000000000000",
                "Created": "2017-02-15T13:47:13000000Z",
                "Data": {
                  "ContentId": "cid123",
                  "ContentAction": "created"
                }
              }
              ] }]]>
            </RequestBody>
            <Validators>
              <JsonSchemaValidator Schema="AddActivitiesRequestSchema" />
              <JsonSchemaValidator Schema="AddActivitiesResponseSchema" />
              <Or>
                <!-- We don't know what order they'll come back in so we need to OR and check both ways -->
                <JsonResponseContentValidator>
                  <StringProperty Name="ActivityResponses[0].Id" IsRequired="true" ExpectedValue="0000000f-0000-0000-0000-000000000000" />
                  <StringProperty Name="ActivityResponses[1].Id" IsRequired="true" ExpectedValue="00000010-0000-0000-0000-000000000000" />
                </JsonResponseContentValidator>
                <JsonResponseContentValidator>
                  <StringProperty Name="ActivityResponses[0].Id" IsRequired="true" ExpectedValue="00000010-0000-0000-0000-000000000000" />
                  <StringProperty Name="ActivityResponses[1].Id" IsRequired="true" ExpectedValue="0000000f-0000-0000-0000-000000000000" />
                </JsonResponseContentValidator>
              </Or>
              <Or>
                <JsonResponseContentValidator>
                  <IntegerProperty Name="ActivityResponses[0].Status" ExpectedValue="0"/>
                </JsonResponseContentValidator>
                <JsonResponseContentValidator>
                  <IntegerProperty Name="ActivityResponses[0].Status" ExpectedValue="3" />
                </JsonResponseContentValidator>
              </Or>
              <Or>
                <JsonResponseContentValidator>
                  <IntegerProperty Name="ActivityResponses[1].Status" ExpectedValue="0"/>
                </JsonResponseContentValidator>
                <JsonResponseContentValidator>
                  <IntegerProperty Name="ActivityResponses[1].Status" ExpectedValue="3" />
                </JsonResponseContentValidator>
              </Or>
            </Validators>
          </AddActivities>
        </Requests>
      </TestCase>

      <TestCase Name="files.AddActivitiesThreeComments" Category="WopiCore">
        <Description>three comments</Description>
        <Requests>
          <AddActivities>
            <RequestBody>
              <![CDATA[{ "Activities": [
              {
                "Type": "comment",
                "Id": "00000011-0000-0000-0000-000000000000",
                "Created": "2017-02-15T13:47:13000000Z",
                "Data": {
                  "ContentId": "cid123",
                  "ContentAction": "created"
                }
              },
              {
                "Type": "comment",
                "Id": "00000012-0000-0000-0000-000000000000",
                "Created": "2017-02-15T13:47:13000000Z",
                "Data": {
                  "ContentId": "cid123",
                  "ContentAction": "created"
                }
              },
              {
                "Type": "comment",
                "Id": "00000013-0000-0000-0000-000000000000",
                "Created": "2017-02-15T13:47:13000000Z",
                "Data": {
                  "ContentId": "cid123",
                  "ContentAction": "created"
                }
              }
              ] }]]>
            </RequestBody>
            <Validators>
              <JsonSchemaValidator Schema="AddActivitiesRequestSchema" />
              <JsonSchemaValidator Schema="AddActivitiesResponseSchema" />
              <!-- We don't know what order they'll come back in and checking each possibility is too much so we'll just make sure that we got three replies -->
              <JsonResponseContentValidator>
                <StringProperty Name="ActivityResponses[0].Id" IsRequired="true" />
                <StringProperty Name="ActivityResponses[1].Id" IsRequired="true" />
                <StringProperty Name="ActivityResponses[2].Id" IsRequired="true" />
              </JsonResponseContentValidator>
              <Or>
                <JsonResponseContentValidator>
                  <IntegerProperty Name="ActivityResponses[0].Status" ExpectedValue="0"/>
                </JsonResponseContentValidator>
                <JsonResponseContentValidator>
                  <IntegerProperty Name="ActivityResponses[0].Status" ExpectedValue="3" />
                </JsonResponseContentValidator>
              </Or>
              <Or>
                <JsonResponseContentValidator>
                  <IntegerProperty Name="ActivityResponses[1].Status" ExpectedValue="0"/>
                </JsonResponseContentValidator>
                <JsonResponseContentValidator>
                  <IntegerProperty Name="ActivityResponses[1].Status" ExpectedValue="3" />
                </JsonResponseContentValidator>
              </Or>
              <Or>
                <JsonResponseContentValidator>
                  <IntegerProperty Name="ActivityResponses[2].Status" ExpectedValue="0"/>
                </JsonResponseContentValidator>
                <JsonResponseContentValidator>
                  <IntegerProperty Name="ActivityResponses[2].Status" ExpectedValue="3" />
                </JsonResponseContentValidator>
              </Or>
            </Validators>
          </AddActivities>
        </Requests>
      </TestCase>
    </TestCases>
  </TestGroup>
  
  <TestGroup Name="CheckFileInfo">
    <TestCases>
      <TestCase Name="FullCheckFileInfoSchema" Document="WordBlankDocument" Category="WopiCore">
        <Description>
          This tests that hosts' CheckFileInfo responses conform to the JSON schema.
        </Description>
        <Requests>
          <CheckFileInfo>
            <Validators>
              <JsonSchemaValidator Schema="CheckFileInfoSchema" />
              <ResponseHeaderValidator Header="X-WOPI-ServerVersion" IsRequired="true" />
              <ResponseHeaderValidator Header="X-WOPI-MachineName" IsRequired="true" />
            </Validators>
          </CheckFileInfo>
        </Requests>
      </TestCase>

      <TestCase Name="CheckFileWithInvalidAccessToken" Document="WordSimpleDocument" Category="WopiCore">
        <Description>
          This tests that host returns 401 or 404 response for a CheckFileInfo request with invalid access token.
        </Description>
        <Requests>
          <CheckFileInfo>
            <Mutators>
              <AccessToken Mutation="INVALID" />
            </Mutators>
            <Validators>
              <Or>
                <ResponseCodeValidator ExpectedCode="401" />
                <ResponseCodeValidator ExpectedCode="404" />
              </Or>
            </Validators>
          </CheckFileInfo>
        </Requests>
      </TestCase>
    </TestCases>
  </TestGroup>

  <TestGroup Name="VersionInCheckFileInfoResponseChangedAfterFileContentChanged">
    <PrereqTests>
      <PrereqTest>FileEditingPrereq</PrereqTest>
      <PrereqTest>UserCanWritePrereq</PrereqTest>
    </PrereqTests>
    <TestCases>
      <TestCase Name="VersionInCheckFileInfoResponseChangedAfterFileContentChanged" Document="WordBlankDocument" Category="WopiCore">
        <Description>
          This tests that file version is changed when the file content changes.
        </Description>
        <Requests>
          <CheckFileInfo>
            <SaveState>
              <State Name="VersionBeforeUpdate" Source="Version" />
            </SaveState>
            <Validators>
              <JsonResponseContentValidator>
                <StringProperty Name="Version" IsRequired="true" />
              </JsonResponseContentValidator>
            </Validators>
          </CheckFileInfo>
          <Lock Lock="LockString" />
          <PutFile Lock="LockString" ResourceId="WordSimpleDocument" />
          <Unlock Lock="LockString" />
          <CheckFileInfo>
            <Validators>
              <JsonResponseContentValidator>
                <StringProperty Name="Version" IsRequired="true" ExpectedStateKey="VersionBeforeUpdate" ShouldMatch="false" />
              </JsonResponseContentValidator>
            </Validators>
          </CheckFileInfo>
        </Requests>
        <CleanupRequests>
          <Unlock Lock="LockString" />
        </CleanupRequests>
      </TestCase>
    </TestCases>
  </TestGroup>

  <TestGroup Name="GetFile">
    <TestCases>
      <TestCase Name="GetFile" Document="WordSimpleDocument" Category="WopiCore">
        <Description>
          This tests that get a file successfully.
        </Description>
        <Requests>
          <CheckFileInfo>
            <SaveState>
              <State Name="FileSize" Source="Size" />
            </SaveState>
          </CheckFileInfo>
          <GetFile>
            <Validators>
              <ResponseHeaderValidator Header="Content-Length" ExpectedStateKey="FileSize" IsRequired="true" ShouldMatch="true" />
              <ResponseHeaderValidator Header="X-WOPI-ServerVersion" IsRequired="true" />
              <ResponseHeaderValidator Header="X-WOPI-MachineName" IsRequired="true" />
            </Validators>
          </GetFile>
        </Requests>
      </TestCase>

      <TestCase Name="GetFileWithInvalidAccessToken" Document="WordSimpleDocument" Category="WopiCore">
        <Description>
          This tests that host returns 401 or 404 response for a GetFile request with invalid access token.
        </Description>
        <Requests>
          <GetFile>
            <Mutators>
              <AccessToken Mutation="INVALID" />
            </Mutators>
            <Validators>
              <Or>
                <ResponseCodeValidator ExpectedCode="401" />
                <ResponseCodeValidator ExpectedCode="404" />
              </Or>
            </Validators>
          </GetFile>
        </Requests>
      </TestCase>
    </TestCases>
  </TestGroup>

  <TestGroup Name="PutRelativeFile">
    <PrereqTests>
      <PrereqTest>FileEditingPrereq</PrereqTest>
      <PrereqTest>UserCanWriteRelativePrereq</PrereqTest>
      <PrereqTest>LocksPrereq</PrereqTest>
      <PrereqTest>SupportsFoldersPrereq</PrereqTest>
    </PrereqTests>
    <TestCases>
      <TestCase Name="PutRelativeFile.SuggestedExtension" Document="WordBlankDocument" Category="WopiCore">
        <Description>
          Tests the basic PutRelativeFile scenario where a suggested extension is specified.
        </Description>
        <Requests>
          <CheckFileInfo />
          <PutRelativeFile PutRelativeFileMode="Suggested" Name=".wopitestx" ResourceId="WordSimpleDocument">
            <SaveState>
              <State Name="NewFileUrl" Source="Url" />
            </SaveState>
            <Validators>
              <JsonResponseContentValidator>
                <StringProperty Name="Name" EndsWith=".wopitestx" IsRequired="true"/>
                <AbsoluteUrlProperty Name="Url" IsRequired="true" MustIncludeAccessToken="true"/>
                <AbsoluteUrlProperty Name="HostViewUrl" IsRequired="true"/>
                <AbsoluteUrlProperty Name="HostEditUrl" IsRequired="true"/>
              </JsonResponseContentValidator>
              <JsonSchemaValidator Schema="PutRelativeFileSchema" />
              <ResponseHeaderValidator Header="X-WOPI-ServerVersion" IsRequired="true" />
              <ResponseHeaderValidator Header="X-WOPI-MachineName" IsRequired="true" />
            </Validators>
          </PutRelativeFile>
          <GetFile OverrideUrl="$State:NewFileUrl">
            <Validators>
              <ResponseContentValidator ExpectedResourceId="WordSimpleDocument" />
            </Validators>
          </GetFile>
        </Requests>
        <CleanupRequests>
          <DeleteFile OverrideUrl="$State:NewFileUrl"/>
        </CleanupRequests>
      </TestCase>

      <TestCase Name="PutRelativeFile.SuggestedName" Document="WordBlankDocument" Category="WopiCore">
        <Description>
          Tests the basic PutRelativeFile scenario where a suggested name is specified.
        </Description>
        <Requests>
          <CheckFileInfo />
          <PutRelativeFile PutRelativeFileMode="Suggested" Name="madeupname.wopitest" ResourceId="WordSimpleDocument">
            <SaveState>
              <State Name="NewFileUrl" Source="Url" />
            </SaveState>
            <Validators>
              <JsonResponseContentValidator>
                <StringProperty Name="Name" EndsWith="wopitest" IsRequired="true"/>
                <AbsoluteUrlProperty Name="Url" IsRequired="true" MustIncludeAccessToken="true" />
                <AbsoluteUrlProperty Name="HostViewUrl" IsRequired="true"/>
                <AbsoluteUrlProperty Name="HostEditUrl" IsRequired="true"/>
              </JsonResponseContentValidator>
            </Validators>
          </PutRelativeFile>
          <GetFile OverrideUrl="$State:NewFileUrl">
            <Validators>
              <ResponseContentValidator ExpectedResourceId="WordSimpleDocument" />
            </Validators>
          </GetFile>
        </Requests>
        <CleanupRequests>
          <DeleteFile OverrideUrl="$State:NewFileUrl"/>
        </CleanupRequests>
      </TestCase>

      <TestCase Name="PutRelativeFile.SuggestedNameConflict" Document="WordBlankDocument" Category="WopiCore">
        <Description>
          Tests the PutRelativeFile scenario where a suggested name is specified but
          a file with the target name already exists. Expects the request to succeed with the host
          choosing a suitable name.
        </Description>
        <Requests>
          <CheckFileInfo />
          <PutRelativeFile PutRelativeFileMode="Suggested" Name="madeupname.wopitest" ResourceId="WordSimpleDocument">
            <SaveState>
              <State Name="NewUrl1" Source="Url" />
            </SaveState>
            <Validators>
              <JsonResponseContentValidator>
                <StringProperty Name="Name" EndsWith="wopitest" IsRequired="true"/>
                <AbsoluteUrlProperty Name="Url" IsRequired="true" MustIncludeAccessToken="true"/>
                <AbsoluteUrlProperty Name="HostViewUrl" IsRequired="true"/>
                <AbsoluteUrlProperty Name="HostEditUrl" IsRequired="true"/>
              </JsonResponseContentValidator>
            </Validators>
          </PutRelativeFile>
          <PutRelativeFile PutRelativeFileMode="Suggested" Name="madeupname.wopitest" ResourceId="WordSimpleDocument">
            <SaveState>
              <State Name="NewUrl2" Source="Url"/>
            </SaveState>
            <Validators>
              <ResponseCodeValidator ExpectedCode="200"/>
              <JsonResponseContentValidator>
                <StringProperty Name="Name" EndsWith="wopitest" ExpectedValue="madeupname.wopitest" IsRequired="true" ShouldMatch="false"/>
                <AbsoluteUrlProperty Name="Url" IsRequired="true" MustIncludeAccessToken="true"/>
                <AbsoluteUrlProperty Name="HostViewUrl" IsRequired="true"/>
                <AbsoluteUrlProperty Name="HostEditUrl" IsRequired="true"/>
              </JsonResponseContentValidator>
            </Validators>
          </PutRelativeFile>
        </Requests>
        <CleanupRequests>
          <DeleteFile OverrideUrl="$State:NewUrl1"/>
          <DeleteFile OverrideUrl="$State:NewUrl2"/>
        </CleanupRequests>
      </TestCase>

      <TestCase Name="PutRelativeFile.RelativeName" Document="WordBlankDocument" Category="WopiCore">
        <Description>
          Tests the PutRelativeFile scenario where a Relative name is specified. Expects the created file to have
          the exact name specified.
        </Description>
        <Requests>
          <CheckFileInfo />
          <PutRelativeFile PutRelativeFileMode="ExactName" Name="madeupname.wopitestx" ResourceId="WordSimpleDocument">
            <SaveState>
              <State Name="NewUrl" Source="Url" />
            </SaveState>
            <Validators>
              <JsonResponseContentValidator>
                <StringProperty Name="Name" ExpectedValue="madeupname.wopitestx" IsRequired="true"/>
                <AbsoluteUrlProperty Name="Url" IsRequired="true" MustIncludeAccessToken="true"/>
                <AbsoluteUrlProperty Name="HostViewUrl" IsRequired="true"/>
                <AbsoluteUrlProperty Name="HostEditUrl" IsRequired="true"/>
              </JsonResponseContentValidator>
            </Validators>
          </PutRelativeFile>
        </Requests>
        <CleanupRequests>
          <DeleteFile OverrideUrl="$State:NewUrl"/>
        </CleanupRequests>
      </TestCase>

      <TestCase Name="PutRelativeFile.RelativeNameOverwriteTrueNoEffect" Document="WordBlankDocument" Category="WopiCore">
        <Description>
          Tests the PutRelativeFile scenario where a Relative name is specified and OverwriteRelative
          is set to true. Since no file with target name exists in this scenario, the header should have
          no effect.
        </Description>
        <Requests>
          <CheckFileInfo />
          <PutRelativeFile PutRelativeFileMode="ExactName" Name="madeupname.wopitestx" ResourceId="WordSimpleDocument" OverwriteRelative="true">
            <SaveState>
              <State Name="NewUrl" Source="Url" />
            </SaveState>
            <Validators>
              <JsonResponseContentValidator>
                <StringProperty Name="Name" ExpectedValue="madeupname.wopitestx" IsRequired="true"/>
                <AbsoluteUrlProperty Name="Url" IsRequired="true" MustIncludeAccessToken="true"/>
                <AbsoluteUrlProperty Name="HostViewUrl" IsRequired="true"/>
                <AbsoluteUrlProperty Name="HostEditUrl" IsRequired="true"/>
              </JsonResponseContentValidator>
            </Validators>
          </PutRelativeFile>
        </Requests>
        <CleanupRequests>
          <DeleteFile OverrideUrl="$State:NewUrl"/>
        </CleanupRequests>
      </TestCase>

      <TestCase Name="PutRelativeFile.RelativeNameOverwriteFalseNoEffect" Document="WordBlankDocument" Category="WopiCore">
        <Description>
          Tests the PutRelativeFile scenario where a Relative name is specified and OverwriteRelative
          is set to false. Since no file with target name exists in this scenario, the header should have
          no effect.
        </Description>
        <Requests>
          <CheckFileInfo />
          <PutRelativeFile PutRelativeFileMode="ExactName" Name="madeupname.wopitestx" ResourceId="WordSimpleDocument" OverwriteRelative="false">
            <SaveState>
              <State Name="NewUrl" Source="Url" />
            </SaveState>
            <Validators>
              <JsonResponseContentValidator>
                <StringProperty Name="Name" ExpectedValue="madeupname.wopitestx" IsRequired="true"/>
                <AbsoluteUrlProperty Name="Url" IsRequired="true" MustIncludeAccessToken="true"/>
                <AbsoluteUrlProperty Name="HostViewUrl" IsRequired="true"/>
                <AbsoluteUrlProperty Name="HostEditUrl" IsRequired="true"/>
              </JsonResponseContentValidator>
            </Validators>
          </PutRelativeFile>
        </Requests>
        <CleanupRequests>
          <DeleteFile OverrideUrl="$State:NewUrl"/>
        </CleanupRequests>
      </TestCase>

      <TestCase Name="PutRelativeFile.RelativeNameConflictNoOverwrite" Document="WordBlankDocument" Category="WopiCore">
        <Description>
          Tests the PutRelativeFile scenario where a Relative name is specified and OverwriteRelative
          is not specified. Since a file with target name exists in this scenario, this should return a 409.
        </Description>
        <Requests>
          <CheckFileInfo />
          <PutRelativeFile PutRelativeFileMode="ExactName" Name="madeupname.wopitestx" ResourceId="WordSimpleDocument">
            <SaveState>
              <State Name="NewUrl" Source="Url" />
            </SaveState>
            <Validators>
              <JsonResponseContentValidator>
                <StringProperty Name="Name" ExpectedValue="madeupname.wopitestx" IsRequired="true"/>
                <AbsoluteUrlProperty Name="Url" IsRequired="true" MustIncludeAccessToken="true"/>
                <AbsoluteUrlProperty Name="HostViewUrl" IsRequired="true"/>
                <AbsoluteUrlProperty Name="HostEditUrl" IsRequired="true"/>
              </JsonResponseContentValidator>
            </Validators>
          </PutRelativeFile>
          <PutRelativeFile PutRelativeFileMode="ExactName" Name="madeupname.wopitestx" ResourceId="WordSimpleDocument">
            <Validators>
              <ResponseCodeValidator ExpectedCode="409"/>
            </Validators>
          </PutRelativeFile>
        </Requests>
        <CleanupRequests>
          <DeleteFile OverrideUrl="$State:NewUrl"/>
        </CleanupRequests>
      </TestCase>

      <TestCase Name="PutRelativeFile.RelativeNameConflictOverwriteFalse" Document="WordBlankDocument" Category="WopiCore">
        <Description>
          Tests the PutRelativeFile scenario where a Relative name is specified and OverwriteRelative
          is set to false. Since a file with target name exists in this scenario, this should return a 409.
        </Description>
        <Requests>
          <CheckFileInfo />
          <PutRelativeFile PutRelativeFileMode="ExactName" Name="madeupname.wopitestx" ResourceId="WordSimpleDocument">
            <SaveState>
              <State Name="NewUrl" Source="Url" />
            </SaveState>
            <Validators>
              <JsonResponseContentValidator>
                <StringProperty Name="Name" ExpectedValue="madeupname.wopitestx" IsRequired="true"/>
                <AbsoluteUrlProperty Name="Url" IsRequired="true" MustIncludeAccessToken="true"/>
                <AbsoluteUrlProperty Name="HostViewUrl" IsRequired="true"/>
                <AbsoluteUrlProperty Name="HostEditUrl" IsRequired="true"/>
              </JsonResponseContentValidator>
            </Validators>
          </PutRelativeFile>
          <PutRelativeFile PutRelativeFileMode="ExactName" Name="madeupname.wopitestx" ResourceId="WordSimpleDocument" OverwriteRelative="false">
            <Validators>
              <ResponseCodeValidator ExpectedCode="409"/>
            </Validators>
          </PutRelativeFile>
        </Requests>
        <CleanupRequests>
          <DeleteFile OverrideUrl="$State:NewUrl"/>
        </CleanupRequests>
      </TestCase>

      <TestCase Name="PutRelativeFile.RelativeNameConflictOverwriteTrue" Document="WordBlankDocument" Category="WopiCore">
        <Description>
          Tests the PutRelativeFile scenario where a Relative name is specified and OverwriteRelative is set to true.
        </Description>
        <Requests>
          <CheckFileInfo />
          <PutRelativeFile PutRelativeFileMode="ExactName" Name="madeupname.wopitestx" ResourceId="WordSimpleDocument">
            <SaveState>
              <State Name="NewUrl1" Source="Url" />
            </SaveState>
            <Validators>
              <JsonResponseContentValidator>
                <StringProperty Name="Name" ExpectedValue="madeupname.wopitestx" IsRequired="true"/>
                <AbsoluteUrlProperty Name="Url" IsRequired="true" MustIncludeAccessToken="true"/>
                <AbsoluteUrlProperty Name="HostViewUrl" IsRequired="true"/>
                <AbsoluteUrlProperty Name="HostEditUrl" IsRequired="true"/>
              </JsonResponseContentValidator>
            </Validators>
          </PutRelativeFile>
          <PutRelativeFile PutRelativeFileMode="ExactName" Name="madeupname.wopitestx" ResourceId="WordComplexDocument" OverwriteRelative="true">
            <SaveState>
              <State Name="NewUrl2" Source="Url" />
            </SaveState>
            <Validators>
              <JsonResponseContentValidator>
                <StringProperty Name="Name" EndsWith=".wopitestx" ExpectedValue="madeupname.wopitestx" IsRequired="true"/>
                <AbsoluteUrlProperty Name="Url" IsRequired="true" MustIncludeAccessToken="true"/>
                <AbsoluteUrlProperty Name="HostViewUrl" IsRequired="true"/>
                <AbsoluteUrlProperty Name="HostEditUrl" IsRequired="true"/>
              </JsonResponseContentValidator>
            </Validators>
          </PutRelativeFile>
          <CheckFileInfo OverrideUrl="$State:NewUrl2">
            <Validators>
              <ResponseCodeValidator ExpectedCode="200" />
            </Validators>
          </CheckFileInfo>
          <GetFile OverrideUrl="$State:NewUrl2">
            <Validators>
              <ResponseContentValidator ExpectedResourceId="WordComplexDocument" />
            </Validators>
          </GetFile>
        </Requests>
        <CleanupRequests>
          <DeleteFile OverrideUrl="$State:NewUrl1"/>
          <DeleteFile OverrideUrl="$State:NewUrl2"/>
        </CleanupRequests>
      </TestCase>

      <TestCase Name="PutRelativeFile.RelativeNameConflictOverwriteTrueLocked" Document="WordBlankDocument" Category="WopiCore">
        <Description>
          Tests the PutRelativeFile scenario where a relative name is specified along with OverwriteRelative
          set to true, but a file with the same target name already exists and is locked.
        </Description>
        <Requests>
          <CheckFileInfo />
          <PutRelativeFile PutRelativeFileMode="ExactName" Name="madeupname.wopitestx" ResourceId="WordSimpleDocument">
            <SaveState>
              <State Name="NewUrl" Source="Url" />
            </SaveState>
            <Validators>
              <JsonResponseContentValidator>
                <StringProperty Name="Name" ExpectedValue="madeupname.wopitestx" IsRequired="true"/>
                <AbsoluteUrlProperty Name="Url" IsRequired="true" MustIncludeAccessToken="true"/>
                <AbsoluteUrlProperty Name="HostViewUrl" IsRequired="true"/>
                <AbsoluteUrlProperty Name="HostEditUrl" IsRequired="true"/>
              </JsonResponseContentValidator>
            </Validators>
          </PutRelativeFile>
          <Lock Lock="LockString" OverrideUrl="$State:NewUrl"/>
          <PutRelativeFile PutRelativeFileMode="ExactName" Name="madeupname.wopitestx" ResourceId="WordSimpleDocument" OverwriteRelative="true">
            <Validators>
              <ResponseCodeValidator ExpectedCode="409"/>
            </Validators>
          </PutRelativeFile>
        </Requests>
        <CleanupRequests>
          <Unlock Lock="LockString" OverrideUrl="$State:NewUrl"/>
          <DeleteFile OverrideUrl="$State:NewUrl"/>
        </CleanupRequests>
      </TestCase>

      <TestCase Name="PutRelativeFile.FileNameReturnedIsCorrectlyEncoded" Document="WordBlankDocument" Category="WopiCore">
        <Description>
          Tests that file name is encoded correctly after a PutRelativeFile operation.
        </Description>
        <Requests>
          <CheckFileInfo />
          <PutRelativeFile PutRelativeFileMode="ExactName" Name="madeup_name.wopitestx" ResourceId="WordSimpleDocument">
            <SaveState>
              <State Name="NewUrl" Source="Url" />
            </SaveState>
            <Validators>
              <JsonResponseContentValidator>
                <StringProperty Name="Name" ExpectedValue="madeup_name.wopitestx" IsRequired="true"/>
              </JsonResponseContentValidator>
            </Validators>
          </PutRelativeFile>
        </Requests>
        <CleanupRequests>
          <DeleteFile OverrideUrl="$State:NewUrl"/>
        </CleanupRequests>
      </TestCase>
    </TestCases>
  </TestGroup>

  <TestGroup Name="PutFile">
    <PrereqTests>
      <PrereqTest>FileEditingPrereq</PrereqTest>
      <PrereqTest>NotReadOnlyPrereq</PrereqTest>
      <PrereqTest>UserCanWritePrereq</PrereqTest>
      <PrereqTest>LocksPrereq</PrereqTest>
    </PrereqTests>
    <TestCases>
      <TestCase Name="PutUnlockFile" Document="WordBlankDocument" Category="WopiCore">
        <Description>
          This tests that put a file successfully.
        </Description>
        <Requests>
          <PutFile Lock="LockString" ResourceId="WordSimpleDocument">
            <Validators>
              <ResponseHeaderValidator Header="X-WOPI-ServerVersion" IsRequired="true" />
              <ResponseHeaderValidator Header="X-WOPI-MachineName" IsRequired="true" />
            </Validators>
          </PutFile>
          <GetFile>
            <Validators>
              <ResponseContentValidator ExpectedResourceId="WordSimpleDocument" />
            </Validators>
          </GetFile>
        </Requests>
      </TestCase>

      <TestCase Name="PutFileAfterLock" Document="WordBlankDocument" Category="WopiCore">
        <Description>
          This tests that put a file with matching lock value successfully after lock.
        </Description>
        <Requests>
          <Lock Lock="LockString" />
          <PutFile Lock="LockString" ResourceId="WordSimpleDocument" />
          <Unlock Lock="LockString" />
          <GetFile>
            <Validators>
              <ResponseContentValidator ExpectedResourceId="WordSimpleDocument" />
            </Validators>
          </GetFile>
        </Requests>
        <CleanupRequests>
          <Unlock Lock="LockString" />
        </CleanupRequests>
      </TestCase>

      <TestCase Name="PutFileAfterUnlockAndRelock" Document="WordBlankDocument" Category="WopiCore">
        <Description>
          This tests that put a file with matching lock value successfully after unlock and relock.
        </Description>
        <Requests>
          <Lock Lock="LockString" />
          <UnlockAndRelock NewLock="NewLockString" OldLock="LockString" />
          <PutFile Lock="NewLockString" ResourceId="WordSimpleDocument" />
          <GetFile>
            <Validators>
              <ResponseContentValidator ExpectedResourceId="WordSimpleDocument" />
            </Validators>
          </GetFile>
        </Requests>
        <CleanupRequests>
          <Unlock Lock="LockString" />
          <Unlock Lock="NewLockString" />
        </CleanupRequests>
      </TestCase>

      <TestCase Name="PutFileWithInvalidAccessToken" Document="WordSimpleDocument" Category="WopiCore">
        <Description>
          This tests that host returns 401 or 404 response for a PutFile request with invalid access token.
        </Description>
        <Requests>
          <Lock Lock="LockString" />
          <PutFile Lock="LockString" ResourceId="WordSimpleDocument">
            <Mutators>
              <AccessToken Mutation="INVALID" />
            </Mutators>
            <Validators>
              <Or>
                <ResponseCodeValidator ExpectedCode="401" />
                <ResponseCodeValidator ExpectedCode="404" />
              </Or>
            </Validators>
          </PutFile>
        </Requests>
        <CleanupRequests>
          <Unlock Lock="LockString" />
        </CleanupRequests>
      </TestCase>
    </TestCases>
  </TestGroup>

  <TestGroup Name="LockMismatchOnPutFileRequest">
    <PrereqTests>
      <PrereqTest>FileEditingPrereq</PrereqTest>
      <PrereqTest>LocksPrereq</PrereqTest>
      <PrereqTest>UserCanWritePrereq</PrereqTest>
    </PrereqTests>
    <TestCases>
      <TestCase Name="LockMismatchOnPutFileRequest" Document="WordBlankDocument" Category="WopiCore">
        <Description>
          This tests that lock mismatch when PutFile with incorrect lock id.
        </Description>
        <Requests>
          <Lock Lock="LockString" />
          <PutFile Lock="IncorrectLockString" ResourceId="WordBlankDocument">
            <Validators>
              <ResponseCodeValidator ExpectedCode="409"/>
            </Validators>
          </PutFile>
        </Requests>
        <CleanupRequests>
          <Unlock Lock="LockString" />
          <Unlock Lock="IncorrectLockString" />
        </CleanupRequests>
      </TestCase>
    </TestCases>
  </TestGroup>

  <TestGroup Name="Locks">
    <PrereqTests>
      <PrereqTest>LocksPrereq</PrereqTest>
    </PrereqTests>
    <TestCases>
      <TestCase Name="SuccessfulLockSequence" Document="WordSimpleDocument" Category="WopiCore">
        <Description>
          Simulates a successful sequence of lock-related requests: Lock, RefreshLock, UnlockAndRelock, Unlock.
        </Description>
        <Requests>
          <Lock Lock="LockString" >
            <Validators>
              <ResponseHeaderValidator Header="X-WOPI-ServerVersion" IsRequired="true" />
              <ResponseHeaderValidator Header="X-WOPI-MachineName" IsRequired="true" />
            </Validators>
          </Lock>
          <RefreshLock Lock="LockString" >
            <Validators>
              <ResponseHeaderValidator Header="X-WOPI-ServerVersion" IsRequired="true" />
              <ResponseHeaderValidator Header="X-WOPI-MachineName" IsRequired="true" />
            </Validators>
          </RefreshLock>
          <UnlockAndRelock NewLock="NewLockString" OldLock="LockString" >
            <Validators>
              <ResponseHeaderValidator Header="X-WOPI-ServerVersion" IsRequired="true" />
              <ResponseHeaderValidator Header="X-WOPI-MachineName" IsRequired="true" />
            </Validators>
          </UnlockAndRelock>
          <Unlock Lock="NewLockString" >
            <Validators>
              <ResponseHeaderValidator Header="X-WOPI-ServerVersion" IsRequired="true" />
              <ResponseHeaderValidator Header="X-WOPI-MachineName" IsRequired="true" />
            </Validators>
          </Unlock>
        </Requests>
        <CleanupRequests>
          <Unlock Lock="LockString" />
          <Unlock Lock="NewLockString" />
        </CleanupRequests>
      </TestCase>

      <!-- LockMismatch -->
      <TestCase Name="LockMismatchOnLockRequest" Document="WordBlankDocument" Category="WopiCore">
        <Description>
          This tests that lock mismatch when trying to refresh the lock with incorrect lock id.
        </Description>
        <Requests>
          <Lock Lock="LockString" />
          <Lock Lock="IncorrectLockString">
            <Validators>
              <ResponseCodeValidator ExpectedCode="409"/>
            </Validators>
          </Lock>
        </Requests>
        <CleanupRequests>
          <Unlock Lock="LockString" />
          <Unlock Lock="IncorrectLockString" />
        </CleanupRequests>
      </TestCase>

      <TestCase Name="LockMismatchOnUnlockRequest" Document="WordBlankDocument" Category="WopiCore">
        <Description>
          This tests that lock mismatch when trying to unlock with incorrect lock id.
        </Description>
        <Requests>
          <Lock Lock="LockString" />
          <Unlock Lock="IncorrectLockString">
            <Validators>
              <ResponseCodeValidator ExpectedCode="409"/>
            </Validators>
          </Unlock>
          <Unlock Lock="LockString" />
        </Requests>
        <CleanupRequests>
          <Unlock Lock="LockString" />
          <Unlock Lock="IncorrectLockString" />
        </CleanupRequests>
      </TestCase>

      <TestCase Name="LockMismatchOnRefreshLockRequest" Document="WordBlankDocument" Category="WopiCore">
        <Description>
          This tests that lock mismatch when trying to refresh lock with incorrect lock id.
        </Description>
        <Requests>
          <Lock Lock="LockString" />
          <RefreshLock Lock="IncorrectLockString">
            <Validators>
              <ResponseCodeValidator ExpectedCode="409"/>
            </Validators>
          </RefreshLock>
        </Requests>
        <CleanupRequests>
          <Unlock Lock="LockString" />
          <Unlock Lock="IncorrectLockString" />
        </CleanupRequests>
      </TestCase>

      <TestCase Name="LockMismatchOnUnlockAndRelockRequest" Document="WordBlankDocument" Category="WopiCore">
        <Description>
          This tests that lock mismatch when trying to unlock and relock with incorrect lock id.
        </Description>
        <Requests>
          <Lock Lock="LockString" />
          <UnlockAndRelock OldLock="IncorrectLockString" NewLock="NewLockString">
            <Validators>
              <ResponseCodeValidator ExpectedCode="409"/>
            </Validators>
          </UnlockAndRelock>
        </Requests>
        <CleanupRequests>
          <Unlock Lock="LockString" />
          <Unlock Lock="IncorrectLockString" />
          <Unlock Lock="NewLockString" />
        </CleanupRequests>
      </TestCase>

      <TestCase Name="LockMismatchAfterUnlockAndRelockRequest" Document="WordBlankDocument" Category="WopiCore">
        <Description>
          This tests that lock mismatch when unlock with old lock.
        </Description>
        <Requests>
          <Lock Lock="LockString" />
          <UnlockAndRelock OldLock="LockString" NewLock="NewLockString" />
          <Unlock Lock="LockString">
            <Validators>
              <ResponseCodeValidator ExpectedCode="409"/>
            </Validators>
          </Unlock>
        </Requests>
        <CleanupRequests>
          <Unlock Lock="LockString" />
          <Unlock Lock="NewLockString" />
        </CleanupRequests>
      </TestCase>

      <TestCase Name="LockFileWithInvalidAccessToken" Document="WordSimpleDocument" Category="WopiCore">
        <Description>
          This tests that host returns 401 or 404 response for locks requests with invalid access token.
        </Description>
        <Requests>
          <Lock Lock="LockString">
            <Mutators>
              <AccessToken Mutation="INVALID" />
            </Mutators>
            <Validators>
              <Or>
                <ResponseCodeValidator ExpectedCode="401" />
                <ResponseCodeValidator ExpectedCode="404" />
              </Or>
            </Validators>
          </Lock>
          <Lock Lock="LockString" />
          <Unlock Lock="LockString">
            <Mutators>
              <AccessToken Mutation="INVALID" />
            </Mutators>
            <Validators>
              <Or>
                <ResponseCodeValidator ExpectedCode="401" />
                <ResponseCodeValidator ExpectedCode="404" />
              </Or>
            </Validators>
          </Unlock>
          <Unlock Lock="LockString" />
        </Requests>
        <CleanupRequests>
          <Unlock Lock="LockString" />
        </CleanupRequests>
      </TestCase>
    </TestCases>
  </TestGroup>

  <TestGroup Name="X-WOPI-LockHeaderReturnedWhenLocksLockMismatch">
    <PrereqTests>
      <PrereqTest>LocksPrereq</PrereqTest>
    </PrereqTests>
    <TestCases>
      <TestCase Name="X-WOPI-LockHeaderIncludedWhenLockMismatchOnLockRequest" Document="WordBlankDocument" Category="WopiCore">
        <Description>
          This tests that X-WOPI-Lock header is returned when lock mismatch for Lock request.
        </Description>
        <Requests>
          <Lock Lock="LockString" />
          <Lock Lock="IncorrectLockString">
            <Validators>
              <LockMismatchValidator ExpectedLock="LockString" />
            </Validators>
          </Lock>
          <Unlock Lock="LockString" />
        </Requests>
        <CleanupRequests>
          <Unlock Lock="LockString" />
          <Unlock Lock="IncorrectLockString" />
        </CleanupRequests>
      </TestCase>

      <TestCase Name="X-WOPI-LockHeaderIncludedWhenLockMismatchOnUnlockRequest" Document="WordBlankDocument" Category="WopiCore">
        <Description>
          This tests that X-WOPI-Lock header is included when responding with the 409 status code for Unlock request if no lock exists on the file.
        </Description>
        <Requests>
          <Unlock Lock="IncorrectLockString">
            <Validators>
              <LockMismatchValidator ExpectedLock="" />
            </Validators>
          </Unlock>
        </Requests>
      </TestCase>

      <TestCase Name="X-WOPI-LockHeaderIncludedWhenLockMismatchOnRefreshLockRequest" Document="WordBlankDocument" Category="WopiCore">
        <Description>
          This tests that X-WOPI-Lock header is included when responding with the 409 status code for RefreshLock request if no lock exists on the file.
        </Description>
        <Requests>
          <RefreshLock Lock="IncorrectLockString">
            <Validators>
              <LockMismatchValidator ExpectedLock="" />
            </Validators>
          </RefreshLock>
        </Requests>
        <CleanupRequests>
          <Unlock Lock="IncorrectLockString" />
        </CleanupRequests>
      </TestCase>

      <TestCase Name="X-WOPI-LockHeaderIncludedWhenLockMismatchOnUnlockAndRelockRequest" Document="WordBlankDocument" Category="WopiCore">
        <Description>
          This tests that X-WOPI-Lock header is included when responding with the 409 status code for UnlockAndRelock request if no lock exists on the file.
        </Description>
        <Requests>
          <UnlockAndRelock OldLock="IncorrectLockString" NewLock="NewLockString">
            <Validators>
              <LockMismatchValidator ExpectedLock="" />
            </Validators>
          </UnlockAndRelock>
        </Requests>
        <CleanupRequests>
          <Unlock Lock="NewLockString" />
        </CleanupRequests>
      </TestCase>
    </TestCases>
  </TestGroup>

  <TestGroup Name="X-WOPI-LockHeaderIsNotReturnedWhenLocksSuccess">
    <PrereqTests>
      <PrereqTest>LocksPrereq</PrereqTest>
    </PrereqTests>
    <TestCases>
      <TestCase Name="X-WOPI-LockHeaderIsNotReturnedWhenLockSuccess" Document="WordBlankDocument" Category="WopiCore">
        <Description>
          This tests that X-WOPI-Lock header is not returned when lock success.
        </Description>
        <Requests>
          <Lock Lock="LockString">
            <Validators>
              <ResponseHeaderValidator Header="X-WOPI-Lock" IsExcluded="true" />
            </Validators>
          </Lock>
        </Requests>
        <CleanupRequests>
          <Unlock Lock="LockString" />
        </CleanupRequests>
      </TestCase>

      <TestCase Name="X-WOPI-LockHeaderIsNotReturnedWhenUnlockSuccess" Document="WordBlankDocument" Category="WopiCore">
        <Description>
          This tests that X-WOPI-Lock header is not returned when Unlock success.
        </Description>
        <Requests>
          <Lock Lock="LockString" />
          <Unlock Lock="LockString">
            <Validators>
              <ResponseHeaderValidator Header="X-WOPI-Lock" IsExcluded="true" />
            </Validators>
          </Unlock>
        </Requests>
        <CleanupRequests>
          <Unlock Lock="LockString" />
        </CleanupRequests>
      </TestCase>

      <TestCase Name="X-WOPI-LockHeaderIsNotReturnedWhenRefreshLockSuccess" Document="WordBlankDocument" Category="WopiCore">
        <Description>
          This tests that X-WOPI-Lock header is not returned when RefreshLock success.
        </Description>
        <Requests>
          <Lock Lock="LockString" />
          <RefreshLock Lock="LockString">
            <Validators>
              <ResponseHeaderValidator Header="X-WOPI-Lock" IsExcluded="true" />
            </Validators>
          </RefreshLock>
        </Requests>
        <CleanupRequests>
          <Unlock Lock="LockString" />
        </CleanupRequests>
      </TestCase>

      <TestCase Name="X-WOPI-LockHeaderIsNotReturnedWhenUnlockAndRelockSuccess" Document="WordBlankDocument" Category="WopiCore">
        <Description>
          This tests that X-WOPI-Lock header is not returned when UnlockAndRelock succeess.
        </Description>
        <Requests>
          <Lock Lock="LockString" />
          <UnlockAndRelock OldLock="LockString" NewLock="NewLockString">
            <Validators>
              <ResponseHeaderValidator Header="X-WOPI-Lock" IsExcluded="true" />
            </Validators>
          </UnlockAndRelock>
        </Requests>
        <CleanupRequests>
          <Unlock Lock="LockString" />
          <Unlock Lock="NewLockString" />
        </CleanupRequests>
      </TestCase>
    </TestCases>
  </TestGroup>

  <TestGroup Name="OperatesOnUnknownFile">
    <PrereqTests>
      <PrereqTest>UserCanWriteRelativePrereq</PrereqTest>
      <PrereqTest>FileEditingPrereq</PrereqTest>
      <PrereqTest>SupportsFoldersPrereq</PrereqTest>
    </PrereqTests>
    <TestCases>
      <TestCase Name="CheckUnknownFile" Document="WordSimpleDocument" Category="WopiCore">
        <Description>
          Tests CheckFileInfo operation returns 404 status code if file is unknown.
        </Description>
        <Requests>
          <PutRelativeFile PutRelativeFileMode="ExactName" Name="madeupname.wopitest" ResourceId="WordSimpleDocument">
            <SaveState>
              <State Name="NewFileUrl" Source="Url" />
            </SaveState>
            <Validators>
              <JsonResponseContentValidator>
                <StringProperty Name="Name" ExpectedValue="madeupname.wopitest" IsRequired="true"/>
              </JsonResponseContentValidator>
            </Validators>
          </PutRelativeFile>
          <DeleteFile OverrideUrl="$State:NewFileUrl" />
          <CheckFileInfo OverrideUrl="$State:NewFileUrl">
            <Validators>
              <ResponseCodeValidator ExpectedCode="404" />
            </Validators>
          </CheckFileInfo>
        </Requests>
      </TestCase>

      <TestCase Name="GetUnknownFile" Document="WordSimpleDocument" Category="WopiCore">
        <Description>
          Tests GetFile operation returns 404 status code if file is unknown.
        </Description>
        <Requests>
          <PutRelativeFile PutRelativeFileMode="ExactName" Name="madeupname.wopitest" ResourceId="WordSimpleDocument">
            <SaveState>
              <State Name="NewFileUrl" Source="Url" />
            </SaveState>
            <Validators>
              <JsonResponseContentValidator>
                <StringProperty Name="Name" ExpectedValue="madeupname.wopitest" IsRequired="true"/>
              </JsonResponseContentValidator>
            </Validators>
          </PutRelativeFile>
          <DeleteFile OverrideUrl="$State:NewFileUrl" />
          <GetFile OverrideUrl="$State:NewFileUrl">
            <Validators>
              <ResponseCodeValidator ExpectedCode="404" />
            </Validators>
          </GetFile>
        </Requests>
      </TestCase>

      <TestCase Name="DeleteUnknownFile" Document="WordSimpleDocument" Category="WopiCore">
        <Description>
          Tests DeleteFile operation returns 404 status code if file is unknown.
        </Description>
        <Requests>
          <PutRelativeFile PutRelativeFileMode="ExactName" Name="madeupname.wopitest" ResourceId="WordSimpleDocument">
            <SaveState>
              <State Name="NewFileUrl" Source="Url" />
            </SaveState>
            <Validators>
              <JsonResponseContentValidator>
                <StringProperty Name="Name" ExpectedValue="madeupname.wopitest" IsRequired="true"/>
              </JsonResponseContentValidator>
            </Validators>
          </PutRelativeFile>
          <DeleteFile OverrideUrl="$State:NewFileUrl" />
          <DeleteFile OverrideUrl="$State:NewFileUrl">
            <Validators>
              <ResponseCodeValidator ExpectedCode="404" />
            </Validators>
          </DeleteFile>
        </Requests>
      </TestCase>

      <TestCase Name="PutRelativeFileBasedOnUnknownFile" Document="WordBlankDocument" Category="WopiCore">
        <Description>
          Tests PutRelativeFile operation returns 404 status code if file is unknown.
        </Description>
        <Requests>
          <PutRelativeFile PutRelativeFileMode="ExactName" Name="madeupname.wopitest" ResourceId="WordSimpleDocument">
            <SaveState>
              <State Name="NewFileUrl" Source="Url" />
            </SaveState>
            <Validators>
              <JsonResponseContentValidator>
                <StringProperty Name="Name" ExpectedValue="madeupname.wopitest" IsRequired="true"/>
              </JsonResponseContentValidator>
            </Validators>
          </PutRelativeFile>
          <CheckFileInfo OverrideUrl="$State:NewFileUrl">
            <Validators>
              <ResponseCodeValidator ExpectedCode="200" />
            </Validators>
          </CheckFileInfo>
          <DeleteFile OverrideUrl="$State:NewFileUrl" />
          <PutRelativeFile OverrideUrl="$State:NewFileUrl" PutRelativeFileMode="ExactName" Name="madeupname2.wopitestx" ResourceId="WordSimpleDocument" OverwriteRelative="true">
            <SaveState>
              <State Name="NewFileUrl2" Source="Url" />
            </SaveState>
            <Validators>
              <ResponseCodeValidator ExpectedCode="404" />
            </Validators>
          </PutRelativeFile>
        </Requests>
        <CleanupRequests>
          <DeleteFile OverrideUrl="$State:NewFileUrl" />
          <DeleteFile OverrideUrl="$State:NewFileUrl2" />
        </CleanupRequests>
      </TestCase>
    </TestCases>
  </TestGroup>

  <TestGroup Name="LocksUnknownFile">
    <PrereqTests>
      <PrereqTest>UserCanWriteRelativePrereq</PrereqTest>
      <PrereqTest>LocksPrereq</PrereqTest>
      <PrereqTest>FileEditingPrereq</PrereqTest>
      <PrereqTest>SupportsFoldersPrereq</PrereqTest>
    </PrereqTests>
    <TestCases>
      <TestCase Name="LockUnknownFile" Document="WordBlankDocument" Category="WopiCore">
        <Description>
          Tests Lock operation returns 404 status code if file is unknown.
        </Description>
        <Requests>
          <PutRelativeFile PutRelativeFileMode="ExactName" Name="madeupname.wopitest" ResourceId="WordSimpleDocument">
            <SaveState>
              <State Name="NewFileUrl" Source="Url" />
            </SaveState>
            <Validators>
              <JsonResponseContentValidator>
                <StringProperty Name="Name" ExpectedValue="madeupname.wopitest" IsRequired="true"/>
              </JsonResponseContentValidator>
            </Validators>
          </PutRelativeFile>
          <CheckFileInfo OverrideUrl="$State:NewFileUrl">
            <Validators>
              <ResponseCodeValidator ExpectedCode="200" />
            </Validators>
          </CheckFileInfo>
          <DeleteFile OverrideUrl="$State:NewFileUrl" />
          <Lock Lock="LockString" OverrideUrl="$State:NewFileUrl">
            <Validators>
              <ResponseCodeValidator ExpectedCode="404" />
            </Validators>
          </Lock>
        </Requests>
        <CleanupRequests>
          <Unlock Lock="LockString" OverrideUrl="$State:NewFileUrl" />
          <DeleteFile OverrideUrl="$State:NewFileUrl" />
        </CleanupRequests>
      </TestCase>

      <TestCase Name="UnlockUnknownFile" Document="WordBlankDocument" Category="WopiCore">
        <Description>
          Tests Unlock operation returns 404 status code if file is unknown.
        </Description>
        <Requests>
          <PutRelativeFile PutRelativeFileMode="ExactName" Name="madeupname.wopitest" ResourceId="WordSimpleDocument">
            <SaveState>
              <State Name="NewFileUrl" Source="Url" />
            </SaveState>
            <Validators>
              <JsonResponseContentValidator>
                <StringProperty Name="Name" ExpectedValue="madeupname.wopitest" IsRequired="true"/>
              </JsonResponseContentValidator>
            </Validators>
          </PutRelativeFile>
          <CheckFileInfo OverrideUrl="$State:NewFileUrl">
            <Validators>
              <ResponseCodeValidator ExpectedCode="200" />
            </Validators>
          </CheckFileInfo>
          <DeleteFile OverrideUrl="$State:NewFileUrl" />
          <Unlock Lock="LockString" OverrideUrl="$State:NewFileUrl" >
            <Validators>
              <ResponseCodeValidator ExpectedCode="404" />
            </Validators>
          </Unlock>
        </Requests>
        <CleanupRequests>
          <DeleteFile OverrideUrl="$State:NewFileUrl" />
        </CleanupRequests>
      </TestCase>

      <TestCase Name="RefreshLockUnknownFile" Document="WordBlankDocument" Category="WopiCore">
        <Description>
          Tests RefreshLock operation returns 404 status code if file is unknown.
        </Description>
        <Requests>
          <PutRelativeFile PutRelativeFileMode="ExactName" Name="madeupname.wopitest" ResourceId="WordSimpleDocument">
            <SaveState>
              <State Name="NewFileUrl" Source="Url" />
            </SaveState>
            <Validators>
              <JsonResponseContentValidator>
                <StringProperty Name="Name" ExpectedValue="madeupname.wopitest" IsRequired="true"/>
              </JsonResponseContentValidator>
            </Validators>
          </PutRelativeFile>
          <CheckFileInfo OverrideUrl="$State:NewFileUrl">
            <Validators>
              <ResponseCodeValidator ExpectedCode="200" />
            </Validators>
          </CheckFileInfo>
          <DeleteFile OverrideUrl="$State:NewFileUrl" />
          <RefreshLock Lock="LockString" OverrideUrl="$State:NewFileUrl">
            <Validators>
              <ResponseCodeValidator ExpectedCode="404" />
            </Validators>
          </RefreshLock>
        </Requests>
        <CleanupRequests>
          <Unlock Lock="LockString" OverrideUrl="$State:NewFileUrl" />
          <DeleteFile OverrideUrl="$State:NewFileUrl" />
        </CleanupRequests>
      </TestCase>

      <TestCase Name="UnlockAndRelockUnknownFile" Document="WordBlankDocument" Category="WopiCore">
        <Description>
          Tests UnlockAndRelock operation returns 404 status code if file is unknown.
        </Description>
        <Requests>
          <PutRelativeFile PutRelativeFileMode="ExactName" Name="madeupname.wopitest" ResourceId="WordSimpleDocument">
            <SaveState>
              <State Name="NewFileUrl" Source="Url" />
            </SaveState>
            <Validators>
              <JsonResponseContentValidator>
                <StringProperty Name="Name" ExpectedValue="madeupname.wopitest" IsRequired="true"/>
              </JsonResponseContentValidator>
            </Validators>
          </PutRelativeFile>
          <CheckFileInfo OverrideUrl="$State:NewFileUrl">
            <Validators>
              <ResponseCodeValidator ExpectedCode="200" />
            </Validators>
          </CheckFileInfo>
          <DeleteFile OverrideUrl="$State:NewFileUrl" />
          <UnlockAndRelock NewLock="NewLockString" OldLock="LockString" OverrideUrl="$State:NewFileUrl">
            <Validators>
              <ResponseCodeValidator ExpectedCode="404" />
            </Validators>
          </UnlockAndRelock>
        </Requests>
        <CleanupRequests>
          <Unlock Lock="NewLockString" OverrideUrl="$State:NewFileUrl" />
          <DeleteFile OverrideUrl="$State:NewFileUrl" />
        </CleanupRequests>
      </TestCase>
    </TestCases>
  </TestGroup>

  <TestGroup Name="PutUnknownFile">
    <PrereqTests>
      <PrereqTest>UserCanWriteRelativePrereq</PrereqTest>
      <PrereqTest>LocksPrereq</PrereqTest>
      <PrereqTest>FileEditingPrereq</PrereqTest>
      <PrereqTest>SupportsFoldersPrereq</PrereqTest>
    </PrereqTests>
    <TestCases>
      <TestCase Name="PutUnknownFile" Document="WordSimpleDocument" Category="WopiCore">
        <Description>
          Tests that host returns status code 404 when update unknown file.
        </Description>
        <Requests>
          <PutRelativeFile PutRelativeFileMode="ExactName" Name="madeupname.wopitest" ResourceId="WordSimpleDocument">
            <SaveState>
              <State Name="NewFileUrl" Source="Url" />
            </SaveState>
            <Validators>
              <JsonResponseContentValidator>
                <StringProperty Name="Name" ExpectedValue="madeupname.wopitest" IsRequired="true"/>
              </JsonResponseContentValidator>
            </Validators>
          </PutRelativeFile>
          <DeleteFile OverrideUrl="$State:NewFileUrl" />
          <PutFile OverrideUrl="$State:NewFileUrl" Lock="LockString" ResourceId="WordSimpleDocument">
            <Validators>
              <ResponseCodeValidator ExpectedCode="404" />
            </Validators>
          </PutFile>
        </Requests>
      </TestCase>
    </TestCases>
  </TestGroup>
  
  <TestGroup Name="RenameFile">
    <PrereqTests>
      <PrereqTest>FileEditingPrereq</PrereqTest>
      <PrereqTest>LocksPrereq</PrereqTest>
      <PrereqTest>SupportsFoldersPrereq</PrereqTest>
      <PrereqTest>UserCanWriteRelativePrereq</PrereqTest>
    </PrereqTests>
    <TestCases>
      <TestCase Name="RenameSucceeds" Document="WordBlankDocument" Category="WopiCore">
        <Description>
          Tests that rename a file successfully.
        </Description>
        <Requests>
          <PutRelativeFile PutRelativeFileMode="ExactName" Name="ValidatorTestFile.docx" ResourceId="WordSimpleDocument">
            <SaveState>
              <State Name="NewFileUrl" Source="Url" />
            </SaveState>
            <Validators>
              <JsonResponseContentValidator>
                <StringProperty Name="Name" ExpectedValue="ValidatorTestFile.docx" IsRequired="true"/>
              </JsonResponseContentValidator>
            </Validators>
          </PutRelativeFile>
          <CheckFileInfo OverrideUrl="$State:NewFileUrl">
            <Validators>
              <ResponseCodeValidator ExpectedCode="200" />
              <JsonResponseContentValidator>
                <BooleanProperty Name="SupportsRename" ExpectedValue="true" IsRequired="true" />
                <BooleanProperty Name="UserCanRename" ExpectedValue="true" IsRequired="true" />
              </JsonResponseContentValidator>
            </Validators>
          </CheckFileInfo>
          <Lock Lock="LockString"  OverrideUrl="$State:NewFileUrl" />
          <RenameFile OverrideUrl="$State:NewFileUrl" Lock="LockString" Name="ValidatorTestFileRenamed">
            <Validators>
              <ResponseCodeValidator ExpectedCode="200" />
              <JsonResponseContentValidator>
                <StringProperty Name="Name" ExpectedValue="ValidatorTestFileRenamed" IsRequired="true" />
              </JsonResponseContentValidator>
              <JsonSchemaValidator Schema="RenameFileSchema" />
              <ResponseHeaderValidator Header="X-WOPI-ServerVersion" IsRequired="true" />
              <ResponseHeaderValidator Header="X-WOPI-MachineName" IsRequired="true" />
            </Validators>
          </RenameFile>
        </Requests>
        <CleanupRequests>
          <Unlock Lock="LockString"  OverrideUrl="$State:NewFileUrl" />
          <DeleteFile OverrideUrl="$State:NewFileUrl" />
        </CleanupRequests>
      </TestCase>

      <TestCase Name="FileNameAfterRenameIsCorrectlyEncoded" Document="WordBlankDocument" Category="WopiCore">
        <Description>
          Tests that file name is encoded correctly after rename file.
        </Description>
        <Requests>
          <PutRelativeFile PutRelativeFileMode="ExactName" Name="madeup_name.docx" ResourceId="WordSimpleDocument">
            <SaveState>
              <State Name="NewFileUrl" Source="Url" />
            </SaveState>
            <Validators>
              <JsonResponseContentValidator>
                <StringProperty Name="Name" ExpectedValue="madeup_name.docx" IsRequired="true"/>
              </JsonResponseContentValidator>
            </Validators>
          </PutRelativeFile>
          <CheckFileInfo OverrideUrl="$State:NewFileUrl">
            <Validators>
              <ResponseCodeValidator ExpectedCode="200" />
              <JsonResponseContentValidator>
                <BooleanProperty Name="SupportsRename" ExpectedValue="true" IsRequired="true" />
                <BooleanProperty Name="UserCanRename" ExpectedValue="true" IsRequired="true" />
              </JsonResponseContentValidator>
            </Validators>
          </CheckFileInfo>
          <Lock Lock="LockString"  OverrideUrl="$State:NewFileUrl" />
          <RenameFile OverrideUrl="$State:NewFileUrl" Lock="LockString" Name="madeup_renamed">
            <Validators>
              <ResponseCodeValidator ExpectedCode="200" />
              <JsonResponseContentValidator>
                <StringProperty Name="Name" ExpectedValue="madeup_renamed" IsRequired="true" />
              </JsonResponseContentValidator>
            </Validators>
          </RenameFile>
        </Requests>
        <CleanupRequests>
          <Unlock Lock="LockString"  OverrideUrl="$State:NewFileUrl" />
          <DeleteFile OverrideUrl="$State:NewFileUrl" />
        </CleanupRequests>
      </TestCase>

      <TestCase Name="RenameUnknownFile" Document="WordBlankDocument" Category="WopiCore">
        <Description>
          Tests that host returns 404 status code for unknown file.
        </Description>
        <Requests>
          <PutRelativeFile PutRelativeFileMode="ExactName" Name="ValidatorTestUnknownFile.docx" ResourceId="WordSimpleDocument">
            <SaveState>
              <State Name="NewFileUrl" Source="Url" />
            </SaveState>
            <Validators>
              <JsonResponseContentValidator>
                <StringProperty Name="Name" ExpectedValue="ValidatorTestUnknownFile.docx" IsRequired="true"/>
              </JsonResponseContentValidator>
            </Validators>
          </PutRelativeFile>
          <CheckFileInfo OverrideUrl="$State:NewFileUrl">
            <Validators>
              <ResponseCodeValidator ExpectedCode="200" />
              <JsonResponseContentValidator>
                <BooleanProperty Name="SupportsRename" ExpectedValue="true" IsRequired="true" />
                <BooleanProperty Name="UserCanRename" ExpectedValue="true" IsRequired="true" />
              </JsonResponseContentValidator>
            </Validators>
          </CheckFileInfo>
          <DeleteFile OverrideUrl="$State:NewFileUrl" />
          <RenameFile OverrideUrl="$State:NewFileUrl" Lock="LockString" Name="ValidatorTestFileRenamed">
            <Validators>
              <ResponseCodeValidator ExpectedCode="404" />
            </Validators>
          </RenameFile>
        </Requests>
        <CleanupRequests>
          <DeleteFile OverrideUrl="$State:NewFileUrl" />
        </CleanupRequests>
      </TestCase>

      <TestCase Name="RenameFileWithInvalidAccessToken" Document="WordBlankDocument" Category="WopiCore">
        <Description>
          Tests that host returns 401 or 404 status code for RenameFile request with invalid access token.
        </Description>
        <Requests>
          <PutRelativeFile PutRelativeFileMode="ExactName" Name="ValidatorTestFileWithInvalidAccessToken.docx" ResourceId="WordSimpleDocument">
            <SaveState>
              <State Name="NewFileUrl" Source="Url" />
            </SaveState>
            <Validators>
              <JsonResponseContentValidator>
                <StringProperty Name="Name" ExpectedValue="ValidatorTestFileWithInvalidAccessToken.docx" IsRequired="true"/>
              </JsonResponseContentValidator>
            </Validators>
          </PutRelativeFile>
          <CheckFileInfo OverrideUrl="$State:NewFileUrl">
            <Validators>
              <ResponseCodeValidator ExpectedCode="200" />
              <JsonResponseContentValidator>
                <BooleanProperty Name="SupportsRename" ExpectedValue="true" IsRequired="true" />
                <BooleanProperty Name="UserCanRename" ExpectedValue="true" IsRequired="true" />
              </JsonResponseContentValidator>
            </Validators>
          </CheckFileInfo>
          <RenameFile OverrideUrl="$State:NewFileUrl" Lock="LockString" Name="ValdatorTestFileRenamed">
            <Mutators>
              <AccessToken Mutation="INVALID" />
            </Mutators>
            <Validators>
              <Or>
                <ResponseCodeValidator ExpectedCode="401" />
                <ResponseCodeValidator ExpectedCode="404" />
              </Or>
            </Validators>
          </RenameFile>
        </Requests>
        <CleanupRequests>
          <DeleteFile OverrideUrl="$State:NewFileUrl" />
        </CleanupRequests>
      </TestCase>

      <TestCase Name="RenameToExistingNameShouldReturn200Or400" Document="WordBlankDocument" Category="WopiCore">
        <Description>
          Tests that rename file should succeed or failed with status code 400 if rename to an existing file name.
        </Description>
        <Requests>
          <PutRelativeFile PutRelativeFileMode="ExactName" Name="ValidatorTestFile.docx" ResourceId="WordSimpleDocument">
            <SaveState>
              <State Name="NewFileUrl" Source="Url" />
            </SaveState>
            <Validators>
              <JsonResponseContentValidator>
                <StringProperty Name="Name" ExpectedValue="ValidatorTestFile.docx" IsRequired="true"/>
              </JsonResponseContentValidator>
            </Validators>
          </PutRelativeFile>
          <PutRelativeFile PutRelativeFileMode="ExactName" Name="ValidatorTestFileForRename.docx" ResourceId="WordSimpleDocument">
            <SaveState>
              <State Name="NewFileUrlForRename" Source="Url" />
            </SaveState>
            <Validators>
              <JsonResponseContentValidator>
                <StringProperty Name="Name" ExpectedValue="ValidatorTestFileForRename.docx" IsRequired="true"/>
              </JsonResponseContentValidator>
            </Validators>
          </PutRelativeFile>
          <CheckFileInfo OverrideUrl="$State:NewFileUrlForRename">
            <Validators>
              <ResponseCodeValidator ExpectedCode="200" />
              <JsonResponseContentValidator>
                <BooleanProperty Name="SupportsRename" ExpectedValue="true" IsRequired="true" />
                <BooleanProperty Name="UserCanRename" ExpectedValue="true" IsRequired="true" />
              </JsonResponseContentValidator>
            </Validators>
          </CheckFileInfo>
          <Lock Lock="LockString"  OverrideUrl="$State:NewFileUrlForRename" />
          <RenameFile OverrideUrl="$State:NewFileUrlForRename" Lock="LockString" Name="ValidatorTestFile">
            <Validators>
              <Or>
                <And>
                  <ResponseCodeValidator ExpectedCode="200" />
                  <JsonResponseContentValidator>
                    <StringProperty Name="Name" IsRequired="true" ExpectedValue="ValidatorTestFile"  ShouldMatch="false" />
                  </JsonResponseContentValidator>
                </And>
                <And>
                  <ResponseCodeValidator ExpectedCode="400" />
                  <ResponseHeaderValidator Header="X-WOPI-InvalidFileNameError" IsRequired="true" />
                </And>
              </Or>
            </Validators>
          </RenameFile>
        </Requests>
        <CleanupRequests>
          <Unlock Lock="LockString"  OverrideUrl="$State:NewFileUrlForRename" />
          <DeleteFile OverrideUrl="$State:NewFileUrl" />
          <DeleteFile OverrideUrl="$State:NewFileUrlForRename" />
        </CleanupRequests>
      </TestCase>
      
      <TestCase Name="LockMismatchOnRenameFileRequest" Document="WordBlankDocument" Category="WopiCore">
        <Description>
          This tests that lock mismatch when RenameFile with incorrect lock id.
        </Description>
        <Requests>
          <PutRelativeFile PutRelativeFileMode="ExactName" Name="ValidatorLockedTestFile.docx" ResourceId="WordBlankDocument">
            <SaveState>
              <State Name="NewFileUrl" Source="Url" />
            </SaveState>
            <Validators>
              <JsonResponseContentValidator>
                <StringProperty Name="Name" ExpectedValue="ValidatorLockedTestFile.docx" IsRequired="true"/>
              </JsonResponseContentValidator>
            </Validators>
          </PutRelativeFile>
          <CheckFileInfo OverrideUrl="$State:NewFileUrl">
            <Validators>
              <ResponseCodeValidator ExpectedCode="200" />
              <JsonResponseContentValidator>
                <BooleanProperty Name="SupportsRename" ExpectedValue="true" IsRequired="true" />
                <BooleanProperty Name="UserCanRename" ExpectedValue="true" IsRequired="true" />
              </JsonResponseContentValidator>
            </Validators>
          </CheckFileInfo>
	        <Lock Lock="LockString" OverrideUrl="$State:NewFileUrl" />
          <RenameFile OverrideUrl="$State:NewFileUrl" Lock="IncorrectLockString" Name="ValdatorTestFileRenamed">
            <Validators>
                <ResponseCodeValidator ExpectedCode="409" />
            </Validators>
          </RenameFile>
        </Requests>
        <CleanupRequests>
	        <Unlock Lock="LockString" OverrideUrl="$State:NewFileUrl" />
          <DeleteFile OverrideUrl="$State:NewFileUrl" />
        </CleanupRequests>
      </TestCase>
    </TestCases>
  </TestGroup>

  <TestGroup Name="GetRestrictedLink">
    <PrereqTests>
      <PrereqTest>SupportsScenarioLinksPrereq</PrereqTest>
    </PrereqTests>
    <TestCases>
      <TestCase Name="GetRestrictedLink" Document="WordBlankDocument" Category="WopiCore">
        <Description>
          Tests the GetRestrictedLink operation for a file
        </Description>
        <Requests>
          <CheckFileInfo />
          <GetRestrictedLink RestrictedLink="FORMS">
            <Validators>
              <ResponseHeaderValidator Header="X-WOPI-RestrictedUseLink" IsRequired="true" IsUrl="true" />
              <ResponseHeaderValidator Header="X-WOPI-ServerVersion" IsRequired="true" />
              <ResponseHeaderValidator Header="X-WOPI-MachineName" IsRequired="true" />
            </Validators>
          </GetRestrictedLink>
        </Requests>
      </TestCase>

      <TestCase Name="GetRestrictedLinkWithInvalidAccessToken" Document="WordBlankDocument" Category="WopiCore">
        <Description>
          Simulates a GetRestrictedLink request with invalid access token and expects a 404 response.
        </Description>
        <Requests>
          <GetRestrictedLink RestrictedLink="FORMS">
            <Mutators>
              <AccessToken Mutation="INVALID" />
            </Mutators>
            <Validators>
              <Or>
                <ResponseCodeValidator ExpectedCode="401" />
                <ResponseCodeValidator ExpectedCode="404" />
              </Or>
            </Validators>
          </GetRestrictedLink>
        </Requests>
      </TestCase>
    </TestCases>
  </TestGroup>

  <TestGroup Name="GetRestrictedLinkOfADeletedFile">
    <PrereqTests>
      <PrereqTest>FileEditingPrereq</PrereqTest>
      <PrereqTest>SupportsFoldersPrereq</PrereqTest>
      <PrereqTest>SupportsScenarioLinksPrereq</PrereqTest>
      <PrereqTest>UserCanWriteRelativePrereq</PrereqTest>
    </PrereqTests>
    <TestCases>
      <TestCase Name="GetRestrictedLinkOfADeletedFileShouldReturnA404" Document="WordBlankDocument" Category="WopiCore">
        <Description>
          Tests that GetRestrictedLink operation should fail with a 404 status code for a deleted file.
        </Description>
        <Requests>
          <PutRelativeFile PutRelativeFileMode="ExactName" Name="madeupname.wopitest" ResourceId="WordSimpleDocument">
            <SaveState>
              <State Name="NewFileUrl" Source="Url" />
            </SaveState>
            <Validators>
              <JsonResponseContentValidator>
                <StringProperty Name="Name" ExpectedValue="madeupname.wopitest" IsRequired="true"/>
              </JsonResponseContentValidator>
            </Validators>
          </PutRelativeFile>
          <CheckFileInfo OverrideUrl="$State:NewFileUrl">
            <Validators>
              <ResponseCodeValidator ExpectedCode="200" />
              <JsonResponseContentValidator>
                <BooleanProperty Name="SupportsScenarioLinks" ExpectedValue="true" IsRequired="true" />
              </JsonResponseContentValidator>
            </Validators>
          </CheckFileInfo>
          <DeleteFile OverrideUrl="$State:NewFileUrl" />
          <GetRestrictedLink OverrideUrl="$State:NewFileUrl" RestrictedLink="FORMS">
            <Validators>
              <ResponseCodeValidator ExpectedCode="404" />
            </Validators>
          </GetRestrictedLink>
        </Requests>
        <CleanupRequests>
          <DeleteFile OverrideUrl="$State:NewFileUrl" />
        </CleanupRequests>
      </TestCase>
    </TestCases>
  </TestGroup>

  <TestGroup Name="RevokeRestrictedLink">
    <PrereqTests>
      <PrereqTest>SupportsScenarioLinksPrereq</PrereqTest>
    </PrereqTests>
    <TestCases>
      <TestCase Name="RevokeRestrictedLink" Document="WordBlankDocument" Category="WopiCore">
        <Description>
          Tests the RevokeRestrictedLink operation for a file
        </Description>
        <Requests>
          <CheckFileInfo />
          <RevokeRestrictedLink RestrictedLink="FORMS">
            <Validators>
              <ResponseCodeValidator ExpectedCode="200"/>
              <ResponseHeaderValidator Header="X-WOPI-ServerVersion" IsRequired="true" />
              <ResponseHeaderValidator Header="X-WOPI-MachineName" IsRequired="true" />
            </Validators>
          </RevokeRestrictedLink>
        </Requests>
      </TestCase>

      <TestCase Name="RevokeRestrictedLinkWithInvalidAccessToken" Document="WordBlankDocument" Category="WopiCore">
        <Description>
          Tests that a RevokeRestrictedLink request with invalid access token expects a 404 response.
        </Description>
        <Requests>
          <RevokeRestrictedLink RestrictedLink="FORMS">
            <Mutators>
              <AccessToken Mutation="INVALID" />
            </Mutators>
            <Validators>
              <Or>
                <ResponseCodeValidator ExpectedCode="401" />
                <ResponseCodeValidator ExpectedCode="404" />
              </Or>
            </Validators>
          </RevokeRestrictedLink>
        </Requests>
      </TestCase>
    </TestCases>
  </TestGroup>

  <TestGroup Name="RevokeRestrictedLinkOfADeletedFile">
    <PrereqTests>
      <PrereqTest>FileEditingPrereq</PrereqTest>
      <PrereqTest>SupportsFoldersPrereq</PrereqTest>
      <PrereqTest>SupportsScenarioLinksPrereq</PrereqTest>
      <PrereqTest>UserCanWriteRelativePrereq</PrereqTest>
    </PrereqTests>
    <TestCases>
      <TestCase Name="RevokeRestrictedLinkOfADeletedFileShouldReturnA404" Document="WordBlankDocument" Category="WopiCore">
        <Description>
          Tests that RevokeRestrictedLink operation should fail with a 404 status code for a deleted file.
        </Description>
        <Requests>
          <PutRelativeFile PutRelativeFileMode="ExactName" Name="madeupname.wopitest" ResourceId="WordSimpleDocument">
            <SaveState>
              <State Name="NewFileUrl" Source="Url" />
            </SaveState>
            <Validators>
              <JsonResponseContentValidator>
                <StringProperty Name="Name" ExpectedValue="madeupname.wopitest" IsRequired="true"/>
              </JsonResponseContentValidator>
            </Validators>
          </PutRelativeFile>
          <CheckFileInfo OverrideUrl="$State:NewFileUrl">
            <Validators>
              <ResponseCodeValidator ExpectedCode="200" />
              <JsonResponseContentValidator>
                <BooleanProperty Name="SupportsScenarioLinks" ExpectedValue="true" IsRequired="true" />
              </JsonResponseContentValidator>
            </Validators>
          </CheckFileInfo>
          <DeleteFile OverrideUrl="$State:NewFileUrl" />
          <RevokeRestrictedLink OverrideUrl="$State:NewFileUrl" RestrictedLink="FORMS">
            <Validators>
              <ResponseCodeValidator ExpectedCode="404"/>
            </Validators>
          </RevokeRestrictedLink>
        </Requests>
      </TestCase>
    </TestCases>
  </TestGroup>

  <TestGroup Name="ReadSecureStore">
    <PrereqTests>
      <PrereqTest>SupportsSecureStorePrereq</PrereqTest>
    </PrereqTests>
    <TestCases>
      <TestCase Name="ReadSecureStore" Document="WordBlankDocument" Category="WopiCore">
        <Description>
          Tests the ReadSecureStore operation for a file
        </Description>
        <Requests>
          <ReadSecureStore>
            <Validators>
              <ResponseCodeValidator ExpectedCode="200" />
            </Validators>
          </ReadSecureStore>
          <ReadSecureStore>
            <Validators>
              <JsonSchemaValidator Schema="ReadSecureStoreSchema" />
              <ResponseHeaderValidator Header="X-WOPI-ServerVersion" IsRequired="true" />
              <ResponseHeaderValidator Header="X-WOPI-MachineName" IsRequired="true" />
            </Validators>
          </ReadSecureStore>
        </Requests>
      </TestCase>

      <TestCase Name="ReadSecureStoreWithInvalidAccessToken" Document="WordBlankDocument" Category="WopiCore">
        <Description>
          Tests that ReadSecureStore request with invalid access token expects a 401 or 404 response.
        </Description>
        <Requests>
          <ReadSecureStore>
            <Mutators>
              <AccessToken Mutation="INVALID" />
            </Mutators>
            <Validators>
              <Or>
                <ResponseCodeValidator ExpectedCode="401" />
                <ResponseCodeValidator ExpectedCode="404" />
              </Or>
            </Validators>
          </ReadSecureStore>
        </Requests>
      </TestCase>
    </TestCases>
  </TestGroup>

  <TestGroup Name="ReadSecureStoreBaseOnUnknownFile">
    <PrereqTests>
      <PrereqTest>UserCanWriteRelativePrereq</PrereqTest>
      <PrereqTest>FileEditingPrereq</PrereqTest>
      <PrereqTest>SupportsFoldersPrereq</PrereqTest>
      <PrereqTest>SupportsSecureStorePrereq</PrereqTest>
    </PrereqTests>
    <TestCases>
      <TestCase Name="ReadSecureStoreBaseOnUnknownFile" Document="WordBlankDocument" Category="WopiCore">
        <Description>
          Tests ReadSecureStore operation returns 404 status code if file is unknown.
        </Description>
        <Requests>
          <PutRelativeFile PutRelativeFileMode="ExactName" Name="madeupname.wopitest" ResourceId="WordSimpleDocument">
            <SaveState>
              <State Name="NewFileUrl" Source="Url" />
            </SaveState>
            <Validators>
              <JsonResponseContentValidator>
                <StringProperty Name="Name" ExpectedValue="madeupname.wopitest" IsRequired="true"/>
              </JsonResponseContentValidator>
            </Validators>
          </PutRelativeFile>
          <DeleteFile OverrideUrl="$State:NewFileUrl" />
          <ReadSecureStore OverrideUrl="$State:NewFileUrl">
            <Validators>
              <ResponseCodeValidator ExpectedCode="404" />
            </Validators>
          </ReadSecureStore>
        </Requests>
      </TestCase>
    </TestCases>
  </TestGroup>

  <TestGroup Name="PerfTraceRequested">
    <PrereqTests>
      <PrereqTest>SupportsSecureStorePrereq</PrereqTest>
    </PrereqTests>
    <TestCases>
      <TestCase Name="X-WOPI-PerfTraceHeaderReturnedWhenX-WOPI-PerfTraceRequestedIsTrue" Document="WordBlankDocument" Category="WopiCore">
        <Description>
          Tests host returns a value for X-WOPI-PerfTrace if the header X-WOPI-PerfTraceRequested in the request is present and equal to "true".
        </Description>
        <Requests>
          <ReadSecureStore PerfTraceRequested="true">
            <Validators>
              <ResponseHeaderValidator Header="X-WOPI-PerfTrace" IsRequired="true" />
            </Validators>
          </ReadSecureStore>
        </Requests>
      </TestCase>
    </TestCases>
  </TestGroup>
</WopiValidation>
